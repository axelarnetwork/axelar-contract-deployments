# Interchain Governance Documentation

## Overview

The Interchain Governance system enables cross-chain governance actions for contracts like `AxelarGateway`, `InterchainTokenService`, and `InterchainTokenFactory`. Governance is controlled by the native PoS-based governance mechanism on the Axelar network.


## Governance Flow

```
1. Proposal Generation & Submission → Create proposal JSON with contract calls and submit to Axelar 
   ↓
2. Voting Period → Validators vote on proposal
   ↓
3. Proposal Passes → GMP call initiated from Axelar
   ↓
4. Relayer Executes → Proposal scheduled on EVM chain with ETA
   ↓
5. Timelock Period → Minimum delay enforced 
   ↓
6. Execution → Permissionless
```

**Key Points:**
- Proposals are created on Axelar and executed on EVM chains via GMP
- Timelock ensures minimum delay between scheduling and execution
- Each proposal is uniquely identified by `keccak256(target, calldata, nativeValue)`

## Proposal Structure

The proposal JSON generated by the script has the following structure:

```json
{
  "title": "Interchain Governance Proposal",
  "description": "Interchain Governance Proposal",
  "contract_calls": [
    {
      "chain": "ethereum",
      "contract_address": "0x...",
      "payload": "base64-encoded-payload"
    }
  ]
}
```

**Field Descriptions:**
- `title`: A string containing the proposal title (defaults to "Interchain Governance Proposal").
- `description`: A string containing the proposal description (defaults to "Interchain Governance Proposal").
- `contract_calls`: An array, where each item is an object representing a contract call:
  - `chain`: The Axelar chain ID as a string (e.g., "ethereum", "avalanche").
  - `contract_address`: The address of the governance contract on the target chain (string).
  - `payload`: A base64-encoded string containing the governance command payload. Decoded, the payload consists of:
    - Command type (uint256): One of:
        - `0` = ScheduleTimelock
        - `1` = CancelTimelock
        - `2` = ApproveMultisig
        - `3` = CancelMultisig
    - Target address (address): The contract on the EVM chain where the proposal will be executed.
    - Calldata (bytes): Encoded data for the function call.
    - Native value (uint256): The amount of native tokens to send with the call.
    - ETA (uint256): The unix timestamp (seconds) after which the proposal can be executed.

## Submission Methods

### Prerequisites

Setup `.env` file

```bash
PRIVATE_KEY=0x...
CHAINS=
ENV=
MNEMONIC=  # required for proposal submission 
```

**Method 1: Direct Submission (Recommended)**
```bash
# Set MNEMONIC in .env file (see Prerequisites section)
ts-node evm/governance.js schedule upgrade 2024-12-31T12:00:00 \
  --targetContractName AxelarGateway
```

**Method 2: File + Cosmos CLI**
```bash
# Generate file
ts-node evm/governance.js schedule upgrade 2024-12-31T12:00:00 \
  --targetContractName AxelarGateway --file proposal.json

# Submit via CLI
axelard tx gov submit-proposal call-contracts proposal.json \
  --deposit <min-deposit>uaxl --from <wallet> --chain-id <chain-id> \
  --gas auto --gas-adjustment 1.4 --node <rpc>
```

**Note:** The minimum deposit can be found via `axelard q gov params` and `axelard q axelarnet params` (if a higher deposit override is set for the specific contract).

## Commands

### Schedule Proposal

Schedule a new timelock proposal. Generates a proposal JSON for submission to Axelar.

```bash
ts-node evm/governance.js schedule <action> <date> [options]
```

**Actions:** `raw`, `upgrade`, `transferGovernance`, `withdraw`

- `raw`: Schedule a custom governance action by providing the target address and calldata directly. Use this for arbitrary function calls that aren't covered by other actions.
- `upgrade`: Upgrade a contract to a new implementation (requires `--targetContractName`)
- `transferGovernance`: Transfer governance of a contract (requires `--targetContractName`)
- `withdraw`: Withdraw native tokens from the governance contract (requires `--target` and `--amount`)

**Date Format:** `YYYY-MM-DDTHH:mm:ss` (UTC format, e.g., `2024-12-31T12:00:00`)

**Examples:**
```bash
# Schedule gateway upgrade 
ts-node evm/governance.js schedule upgrade 2024-12-31T12:00:00 \
  --targetContractName AxelarGateway

# Raw action - custom function call
ts-node evm/governance.js schedule raw 2024-12-31T12:00:00 \
  --target 0x1234... --calldata 0xabcd...
```


### Cancel Proposal

Cancel a scheduled timelock proposal before execution.

```bash
ts-node evm/governance.js cancel <action> [options]
```

**Options:** Same as `schedule` command (except `--file` and date argument). All options from `schedule` are available.

### Check Proposal ETA

Query the execution time for a scheduled proposal.

```bash
ts-node evm/governance.js eta --target <address> --calldata <hex>
# OR
ts-node evm/governance.js eta --proposal <encoded>
```


### Submit Proposal (if relayers fail to submit)

Manually submit a proposal when relayers haven't executed the GMP call automatically.

```bash
ts-node evm/governance.js submit <action> <commandId> <date> [options]
```

**Note:** This command calls `governance.execute()` directly on the EVM chain when relayers fail to execute automatically.

**How to Find the `commandId` from Axelarscan:**

1. Go to https://axelarscan.io/gmp/search
2. Apply filters:
   - **Source Chain**: Select `axelar`
   - **Method**: Call Contract
3. Find the most recent GMP call that matches your proposal (sender - Axelar Governance)
4. Open the transaction details and locate the `commandId` in the see more section(32-byte hex string, e.g., `0x...`)
5. **Verification**: Cross-check the sender address in the GMP call details:

### Execute Proposal

Execute a scheduled proposal after the timelock period has passed.

```bash
ts-node evm/governance.js execute --target <address> --calldata <hex>
# OR
ts-node evm/governance.js execute --proposal <encoded>
```



## AxelarServiceGovernance Commands

`AxelarServiceGovernance` adds operator approval functionality (bypasses timelock). Only available for `AxelarServiceGovernance`:

### Schedule Multisig Proposal

```bash
ts-node evm/governance.js schedule-multisig <target> <calldata> <date> [options]
```

### Cancel Multisig Proposal

```bash
ts-node evm/governance.js cancel-multisig <target> <calldata> [options]
```


### Submit Multisig Proposal

```bash
ts-node evm/governance.js submit-multisig <target> <calldata> <commandId> <date> [options]
```


## Common Workflows

**Upgrade Gateway:**
```bash
# 1. Schedule and submit (requires MNEMONIC in .env)
ts-node evm/governance.js schedule upgrade 2024-12-31T12:00:00 \
  --targetContractName AxelarGateway

# 2. Wait for voting period and proposal to pass

# 3. Check if GMP was executed (check Axelarscan for batch)
# If relayers failed, manually submit:
ts-node evm/governance.js submit upgrade <commandId> 2024-12-31T12:00:00 \
  --targetContractName AxelarGateway

# 4. Check ETA (after proposal is scheduled)
ts-node evm/governance.js eta --targetContractName AxelarGateway

# 5. Execute (after ETA passes)
ts-node evm/governance.js execute --targetContractName AxelarGateway
```

**Transfer Governance:**
```bash
ts-node evm/governance.js schedule transferGovernance 2024-12-31T12:00:00 \
  --targetContractName AxelarGateway --newGovernance 0xNewAddress
```

**Withdraw Tokens:**
```bash
ts-node evm/governance.js schedule withdraw 2024-12-31T12:00:00 \
  --target 0xRecipient --amount 1.0
```


## Troubleshooting

| Error | Solution |
|-------|----------|
| "Proposal already exists" | Cancel existing proposal or use different parameters |
| "TimeLock proposal is not yet eligible" | Wait until ETA passes |
| "Proposal does not exist" | Check if GMP call was executed successfully |
| "Invalid governance action for InterchainGovernance" | Use `-c AxelarServiceGovernance` for multisig commands |

