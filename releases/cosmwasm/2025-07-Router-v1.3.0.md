# Cosmwasm Router v1.3.0

|                | **Owner**                             |
| -------------- | ------------------------------------- |
| **Created By** | @sdavidson1177 <solomon@interoplabs.io>         |

| **Network**          | **Deployment Status** | **Date**   |
| -------------------- | --------------------- | ---------- |
| **Devnet Amplifier** | -                     | TBD        |
| **Stagenet**         | -                     | TBD        |
| **Testnet**          | -                     | TBD        |
| **Mainnet**          | -                     | TBD        |



[Release](https://github.com/axelarnetwork/axelar-amplifier/tree/router-v1.3.0)

## Background

Changes in this release:

1. Router contract stores the coordinator address. This address is given when the router contract is instantiated. This allows the router to give the coordinator permission to execute message (such as when registering chains).

## Deployment

- This rollout upgrades the amplifier router contract from `v1.2.0` to `v1.3.0`
- State migration is required. The router must be supplied with the coordinator's address

1. Upload new Router contract

| Network          | `INIT_ADDRESSES`                                                                                                                            | `RUN_AS_ACCOUNT`                                | `DEPOSIT_VALUE` |
| ---------------- | ------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------- | --------------- |
| devnet-amplifier | `axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj`<br/> `axelar1zlr7e5qf3sz7yf890rkh9tcnu87234k6k7ytd9`                                               | `axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj` | `100000000`     |
| stagenet         | `axelar1pumrull7z8y5kc9q4azfrmcaxd8w0779kg6anm`<br/>`axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj`<br/>`axelar12qvsvse32cjyw60ztysd3v655aj5urqeup82ky` | `axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj` | `100000000`     |
| testnet          | `axelar1uk66drc8t9hwnddnejjp92t22plup0xd036uc2`<br/>`axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj`<br/>`axelar12f2qn005d4vl03ssjq07quz6cja72w5ukuchv7` | `axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj` | `2000000000`    |
| mainnet          | `axelar1uk66drc8t9hwnddnejjp92t22plup0xd036uc2`<br/>`axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj`<br/>`axelar1nctnr9x0qexemeld5w7w752rmqdsqqv92dw9am` | `axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj` | `2000000000`    |

```bash
ts-node cosmwasm/submit-proposal.js store -c Router -t "Upload Router contract v1.3.0" -d "Upload Router contract v1.3.0" -r $RUN_AS_ACCOUNT --deposit $DEPOSIT_VALUE --instantiateAddresses $INIT_ADDRESSES --version 1.3.0
```

2. Upgrade Router contract

Provide coordinator address to the router.

```bash
ts-node cosmwasm/submit-proposal.js migrate \
  -c Router \
  -t "Migrate Router to v1.3.0" \
  -d "Router to v1.3.0" \
  --msg "{\"coordinator\": \"$COORDINATOR_ADDRESS\"}" \
  --fetchCodeId \
  --deposit $DEPOSIT_VALUE
```

## Checklist

Verify router contract version

```bash
axelard query wasm contract-state raw $ROUTER_ADDRESS 636F6E74726163745F696E666F -o json | jq -r '.data' | base64 -d
```
Expected output

```bash
{"contract":"router","version":"1.3.0"}
```

Verify coordinator address stored on router

```bash
axelard q wasm contract-state raw --ascii $ROUTER_ADDRESS 'config' -o json | jq -r '.data' | base64 -d | jq -r '.coordinator'
```

Expected output

```bash
$COORDINATOR_ADDRESS
```

Ensure coordinator address match predicted one.

```bash
cat ./axelar-chains-config/info/$ENV.json | jq ".axelar.contracts.Coordinator.address" | tr -d '"' | grep $COORDINATOR_ADDRESS
```
