# axelard v1.3.2

|                | **Owner**                             |
| -------------- | ------------------------------------- |
| **Created By** | @chipshort <christoph@interoplabs.io> |
| **Deployment** |                                       |

| **Network**          | **Deployment Status**     | **Date**           |
| -------------------- | ------------------------- | ------------------ |
| **Devnet Amplifier** | Deployed                  | 2025-11-24 (1.3.0) |
| **Stagenet**         | Deployed                  | 2025-11-25 (1.3.0) |
| **Testnet**          | Deployed                  | 2025-12-01 (1.3.0) |
| **Mainnet**          | Pending update from 1.3.0 | 2025-12-08 (1.3.0) |

[Release v1.3.2](https://github.com/axelarnetwork/axelar-core/releases/tag/v1.3.2)

## Background

### Changes since v1.2.4 (up to 1.3.0):

- Updates Cosmos SDK to v0.50, WasmD to v0.54, WasmVM to v2.2, CometBFT to v0.38, also updates various other dependencies.
- The governance module now uses the new message-based governance proposals
- Clients interacting with Axelar need to be updated to use the new protobuf messages. This includes ampd!
- Some of the Cosmos SDK modules include in-place storage migrations
- New `x/consensus` module has been added to the SDK, which is used to manage consensus parameters.
- Performance improvements: we're reducing the block time
- All block-based params have to be increased accordingly. Most have been [increased in a migration][param-pr],
  but some need to be updated after the upgrade.

### Additional changes in v1.3.1 (v1.3.1 is a drop-in replacement for v1.3.0 - no upgrade proposal required):

- **non-GMP-based mechanisms for token transfers such as transfer via linked deposit address and direct token transfers are being deprecated, should no longer be used and will stop working at some point in the near future**
- Reverted fast node config defaults to pre-1.3.0 values to avoid re-indexing the entire state during migration (which would take hours)
- Removed broken CLI commands
- Updated additional parameter defaults based on devnet/stagenet experience running 1.3.0 with ~1s block times, including vald parameters

### Additional changes in v1.3.2 (v1.3.2 is a drop-in replacement for v1.3.1 - no upgrade proposal required):

- Added statically linked binary for Linux releases - portable binaries that run on any Linux distribution without glibc compatibility issues
- Added `build-static` Makefile target to extract statically linked binaries from Docker images
- Fixed Rosetta API base64 encoding issue by updating to patched Rosetta dependency
- Reorganized and renamed GitHub Actions workflows for better clarity (all workflow files now have descriptive prefixes like `ci-`, `ops-`, `release-`)

## Migrate CosmWasm Contracts

Migrate Multisig contract and all Voting Verifier contracts to increase poll/signing block expiry values to account for faster block times. See [Amplifier Contracts Migration Guide](../cosmwasm/2025-11-Cosmos-SDK-v0.50-amplifier-contracts-migration-guide.md).

## Deployment Steps for Axelar Maintainers

1. Submit upgrade proposal and vote on upgrade proposal. Roughly like this:

    ```bash
    axelard tx gov submit-proposal \
         software-upgrade "v1.3" \
         --upgrade-height $upgradeHeight \
         --deposit ${govProposalDepositAmount}uaxl \
         --description "This proposal is intended to upgrade axelar core to v1.3" \
         --title "Axelar v1.3" \
         --from validator --gas auto --gas-adjustment 1.2

     axelard tx gov vote ${proposalId} yes \
        --from validator --gas auto --gas-adjustment 1.5
    ```

2. Inform all validators about the upgrade and upgrade height.
3. Wait for proposal to pass.
4. When upgrade height is reached, follow the steps for Axelar Validators below to upgrade our nodes.

### Update Mint and Slashing module params

1.  Create proposal file

    | **Network**          | **mint_denom** | **blocks_per_year** | **old_blocks_per_year** | **signed_blocks_window** | **deposit**           |
    | -------------------- | -------------- | ------------------- | ----------------------- | ------------------------ | --------------------- |
    | **Devnet Amplifier** | `uamplifier`   | `23727519`          | `6311520`               | `129925`                 | `100000000uamplifier` |
    | **Stagenet**         | `uaxl`         | `19723500`          | `6311520`               | `108000`                 | `100000000uaxl`       |
    | **Testnet**          | `uaxl`         | `18896766`          | `5437241`               | `103473`                 | `2000000000uaxl `     |
    | **Mainnet**          | `uaxl`         | `18896766`          | `5345084`               | `103473`                 | `2000000000uaxl`      |

    ```bash
    cat > proposal.json << 'EOF'
    {
    "messages": [
        {
        "@type": "/cosmos.mint.v1beta1.MsgUpdateParams",
        "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
        "params": {
            "mint_denom": "[mint_denom]",
            "inflation_rate_change": "0.000000000000000000",
            "inflation_max": "0.000000000000000000",
            "inflation_min": "0.000000000000000000",
            "goal_bonded": "0.670000000000000000",
            "blocks_per_year": "[blocks_per_year]"
        }
        },
        {
        "@type": "/cosmos.slashing.v1beta1.MsgUpdateParams",
        "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
        "params": {
            "signed_blocks_window": "[signed_blocks_window]",
            "min_signed_per_window": "0.500000000000000000",
            "downtime_jail_duration": "[CURRENT_VALUE]",
            "slash_fraction_double_sign": "0.020000000000000000",
            "slash_fraction_downtime": "0.000100000000000000"
        }
        }
    ],
    "metadata": "",
    "deposit": "[deposit]",
    "title": "Update Mint and Slashing Parameters for SDK v0.50 Block Time",
    "summary": "Adjust blocks_per_year from [old_blocks_per_year] to [blocks_per_year] and signed_blocks_window from 35,000 to 175,000 to maintain correct timing after block time reduction following the SDK v0.50 upgrade."
    }
    EOF
    ```

1.  Submit proposal

    ```bash
    axelard tx gov submit-proposal proposal.json \
    --gas auto \
    --gas-adjustment 1.5
    ```

1.  Wait for proposal to pass and query module params
    ```bash
    axelard query mint params
    axelard query slashing params
    ```

### Update expedited proposal params

1. Create proposal file. This proposal will be submitted after the network upgrade.

    | **Network**          | **expedited_voting_period** | **expedited_min_deposit** | **denom**    |
    | -------------------- | --------------------------- | ------------------------- | ------------ |
    | **Devnet-Amplifier** | `90s`                       | `150000000`               | `uamplifier` |
    | **Stagenet**         | `90s`                       | `150000000`               | `uaxl`       |
    | **Testnet**          | `300s`                      | `3000000000`              | `uaxl`       |
    | **Mainnet**          | `86400s`                    | `3000000000`              | `uaxl`       |

    ```bash
    cat > proposal.json << 'EOF'
    {
      "messages": [
        {
          "@type": "/cosmos.gov.v1.MsgUpdateParams",
          "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
          "params": {
            "min_deposit": [
              {
                "denom": "[CURRENT_VALUE]",
                "amount": "[CURRENT_VALUE]"
              }
            ],
            "max_deposit_period": "[CURRENT_VALUE]",
            "voting_period": "[CURRENT_VALUE]",
            "quorum": "[CURRENT_VALUE]",
            "threshold": "[CURRENT_VALUE]",
            "veto_threshold": "[CURRENT_VALUE]",
            "min_initial_deposit_ratio": "[CURRENT_VALUE]",
            "proposal_cancel_ratio": "[CURRENT_VALUE]",
            "proposal_cancel_dest": "",
            "expedited_voting_period": "[expedited_voting_period]",
            "expedited_threshold": "[CURRENT_VALUE]",
            "expedited_min_deposit": [
              {
                "denom": "[denom]",
                "amount": "[expedited_min_deposit]"
              }
            ],
            "burn_vote_quorum": false,
            "burn_proposal_deposit_prevote": false,
            "burn_vote_veto": [CURRENT_VALUE],
            "min_deposit_ratio": "[CURRENT_VALUE]"
          }
        }
      ],
      "metadata": "",
      "deposit": "2000000000uaxl",
      "title": "Update Governance Expedited Parameters",
      "summary": "Configure expedited proposal settings for faster governance"
    }
    EOF
    ```

1. Submit proposal

    ```bash
    axelard tx gov submit-proposal proposal.json \
    --gas auto \
    --gas-adjustment 1.5
    ```

1. Wait for proposal to pass and query module params
    ```bash
    axelard query gov params
    ```

### Ensure Cosmos SDK Version is updated in `axelar-contract-deployments` Config

```javascript
"cosmosSDK": "0.50.14"
```

### Update Reward Pools

Update all reward pools to account for faster block time. See [Amplifier Contracts Migration Guide](../cosmwasm/2025-11-Cosmos-SDK-v0.50-amplifier-contracts-migration-guide.md).

### Post-Upgrade Checklist for Maintainers

- [ ] Testing
    - [ ] General testing: GMP calls, IBC transfers, key rotation
    - [ ] Ensure new `UpdateParams` message works in new message-based proposals as expected. To check this, submit a proposal to change a parameter for one of our modules.
    - [ ] Test Rosetta API is working. To do this, a rosetta checker needs to be spun up and run against one of the nodes. Haiyi and Steven can help with this.
- [ ] Post-Upgrade parameter updates:
    - [ ] Monitor actual block time in production to assess whether [block-based param updates][param-pr] were accurate or if we need to adjust them again.
    - [ ] Update the `slashing` module's `signed_blocks_window` according to the new block time (i.e. if block time is 5x lower, then `signed_blocks_window` should be 5x higher).
    - [ ] Update the `mint` module's `blocks_per_year` to the new value based on how fast the block production is.

[param-pr]: https://github.com/axelarnetwork/axelar-core/pull/2282

### Updating from v1.3.0 to v1.3.2

For networks already running `v1.3.0` (devnet-amplifier, stagenet), a governance proposal is required to update the grace period parameters that were adjusted based on production experience. Since `v1.3.2` is a drop-in replacement for `v1.3.1`, the parameter changes are the same:

| Module            | Parameter              | Old Value (v1.3.0) | New Value (v1.3.2) |
| ----------------- | ---------------------- | ------------------ | ------------------ |
| `evm` (per chain) | `voting_grace_period`  | `15`               | `2`                |
| `multisig`        | `keygen_grace_period`  | `50`               | `3`                |
| `multisig`        | `signing_grace_period` | `50`               | `3`                |

Example proposal for updating multisig params (query current values with `axelard query multisig params`):

```bash
cat > proposal.json << 'EOF'
{
  "messages": [
    {
      "@type": "/axelar.multisig.v1beta1.UpdateParamsRequest",
      "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
      "params": {
        "keygen_threshold": "[CURRENT_VALUE]",
        "signing_threshold": "[CURRENT_VALUE]",
        "keygen_timeout": "[CURRENT_VALUE]",
        "keygen_grace_period": "3",
        "signing_timeout": "[CURRENT_VALUE]",
        "signing_grace_period": "3",
        "active_epoch_count": "[CURRENT_VALUE]"
      }
    }
  ],
  "metadata": "",
  "deposit": "[deposit]",
  "title": "Update Multisig Grace Periods for v1.3.2",
  "summary": "Reduce keygen_grace_period and signing_grace_period from 50 to 3 based on production experience with ~1s block times."
}
EOF
```

Example proposal for updating evm params for a single chain (query current values with `axelard query evm params [chain]`):

```bash
cat > proposal.json << 'EOF'
{
  "messages": [
    {
      "@type": "/axelar.evm.v1beta1.UpdateParamsRequest",
      "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
      "params": {
        "chain": "[CHAIN_NAME]",
        "confirmation_height": "[CURRENT_VALUE]",
        "network": "[CURRENT_VALUE]",
        "networks": "[CURRENT_VALUE]",
        "voting_threshold": "[CURRENT_VALUE]",
        "min_voter_count": "[CURRENT_VALUE]",
        "commands_gas_limit": "[CURRENT_VALUE]",
        "voting_grace_period": "2",
        "end_blocker_limit": "[CURRENT_VALUE]",
        "transfer_limit": "[CURRENT_VALUE]",
        "revote_locking_period": "[CURRENT_VALUE]"
      }
    }
  ],
  "metadata": "",
  "deposit": "[deposit]",
  "title": "Update EVM Voting Grace Period for [CHAIN_NAME]",
  "summary": "Reduce voting_grace_period from 15 to 2 based on production experience with ~1s block times."
}
EOF
```

## Deployment Steps for Axelar Validators

### Prerequisites

- If building from source, use Go 1.25
- libwasmvm has been updated from `v1.5.8` to `v2.2.4`, make sure to update the dependency if you are using the `axelard` binary. Prebuilt binaries, including a statically linked linux binary that doesn't require libwasmvm on the system, are available on the `v1.3.2` [release page](https://github.com/axelarnetwork/axelar-core/releases/tag/v1.3.2) as [axelard-linux-amd64-v1.3.2-static](https://github.com/axelarnetwork/axelar-core/releases/download/v1.3.2/axelard-linux-amd64-v1.3.2-static)
- Prepare to [update ampd to 1.13.2] at the same time
- Ensure your system has at least 64GB of RAM to handle the upgrade process

[update ampd to 1.13.2]: ../ampd/2025-11-17-ampd-v1.13.2.md

### Upgrade Details by Network

| Network     | Proposal                                          | Upgrade Height                                                    | Upgrade Time (UTC) |
| ----------- | ------------------------------------------------- | ----------------------------------------------------------------- | ------------------ |
| **Testnet** | [404](https://testnet.axelarscan.io/proposal/404) | [22091980](https://www.mintscan.io/axelar-testnet/block/22091980) | 2 PM               |
| **Mainnet** | 421                                               | [21163285](https://www.mintscan.io/axelar/block/21163285)         | 2:00-2:15 PM       |

### Upgrade Process

1. Wait for upgrade height to be reached.
2. Stop the validator `axelard` node, `vald`, and `ampd` (if you are running a verifier).
3. Update `config.toml`:
    - Update the following parameter:

        | Parameter        | Old Value (v1.2.4) | New Value (v1.3.2) |
        | ---------------- | ------------------ | ------------------ |
        | `timeout_commit` | `5s`               | `1s`               |

    - Remove the following `vald` specific entries if they exist, to use the new defaults:
        - `max_blocks_behind_latest` (in root section)
        - `max_retries` (in `[broadcast]` section)
        - `min_sleep_before_retry` (in `[broadcast]` section)
        - `max_timeout` (in `[broadcast]` section)

4. (For verifiers only) Update the `config.toml` for `ampd`

- Under the `tofnd_config` make sure you update the configuration:
  Please remove the current configuration:

    ```toml
    [tofnd_config.timeout]
    secs = 3
    nanos = 0
    ```

    And replace it with

    ```toml
    [tofnd_config]
    batch_gas_limit="1e+07"
    timeout="3s"
    url="http://127.0.0.1:50051"
    ```

- At the root of the `ampd` `config.toml` please update the [tm_grpc_timeout] config:

    Remove the existing config:

    ```toml
    [tm_grpc_timeout]
    secs = 5
    nanos = 0
    ```

    And replace it with the following:

    ```toml
    tm_grpc_timeout="5s"
    ```

4. Restart the validator node, `vald`, and `ampd` with the new binaries.
   When restarting `axelard`, it will perform migrations, which will take a while to complete.
   Also note that you can expect to see this error during the migration, which is **completely normal** and can be ignored:
    ```
    ERR failed to get consensus params err="collections: not found: key 'no_key' of type github.com/cosmos/gogoproto/tendermint.types.ConsensusParams" module=server
    ```
5. Please also upgrade any other Axelar nodes you operate (RPC nodes etc.), and restart your IBC relayer (e.g. hermes).

### Post-Deployment Checklist

- [ ] Verify that nodes are producing new blocks after the upgrade.
- [ ] Verify vald is participating in message validation, signing, heartbeats etc.
- TODO: add e2e test instructions
- [ ] Test [GMP calls](../evm/EVM-GMP-Release-Template.md)

## Troubleshooting

1. If you encounter an app hash error ensure you have `libwasm v2.2.4` which can be obtained from https://github.com/CosmWasm/wasmvm/releases/download/v2.2.4/libwasmvm.x86_64.so. Before restarting node:

2. Ensure system environment variable `LD_LIBRARY_PATH` is specified to correct location if using binary. For docker image no change is necessary.

3. If you see the message `migrating module auth from version 2 to version 3`, it means the upgrade has started. The upgrade will take 40-60 minutes to complete, and you will see additional logs as the upgrade proceeds through other modules.

4. If you hit the error `Upgrading IAVL storage for faster queries`. Then please make sure the following is added to your `config.toml` file at the root:

```bash
iavl-cache-size = 0
iavl-disable-fastnode = true
```

Restart without reverting to the previous block. If you hit this case wait time for the upgrade to go through may be close to an hour.

5. If you hit the error: `undefined symbol: migrate_with_info`. Then please make sure you are using the correct `libwasm` version (`2.2.4`)

6. If you hit the error: `ERR failed to get consensus params err="collections: not found: key 'no_key' of type`. No action is necessary so that during preblock the upgrade plan can be executed and the consensus params set for the first time in the new format.

- The reason for this is because we are skipping version `v0.47`.
- The wait time will be about 12-20 minutes for the upgrade to go through if you reach this case.

7. Required RAM is 64GB. If your process runs out of memory during the upgrade you will have to increase your system RAM to at least `64GB` and the upgrade will restart from the beginning and progress will be lost

8. If your key has disappeared from the keyring file.

- `No records were found in keyring`
  Then please re-add the broadcaster account by running `axelard keys add broadcaster --recover --keyring-backend file`

9. If you hit an error saying: `failed to execute message: too many heartbeats received from operator in vald`. Then ensure that you have `indexer="kv"` in your `config.toml` file under the `[tx_index]` key

Upon the completion of this testnet migration several key findings were observed:

- **Archival node:** Migration took **~12.5 hours**, plus additional catch-up time.
    - Peak memory usage observed: **~42 GB**
- **Validator node:** Migration took **~1 hour**, plus catch-up.
    - Peak memory usage observed: **~40 GB**
- Other RPC operators reported migration durations ranging **from ~50 to ~100 minutes**.

#### Additional Test Results

Follow-up testing on mainnet RPC provided more detailed resource utilization metrics:

**Archival RPC Nodes:**

- CPU: **~3 cores** (with spikes, though CPU throttling will occur)
- Memory: **~42 GB** short peak (with spikes up to **~45 GB** for very brief periods)

**Standard RPC Nodes:**

- CPU: **~2.5 cores** (with spikes, though CPU throttling will occur)
- Memory: **~38 GB** average peak
    - Individual nodes varied: some peaked at **~40 GB**, while others required no more than **~32 GB**

#### Migration Behavior Observed

- If the `axelar-core` process restarted during migration, the migration started over from the beginning, rather than resuming from prior progress.
- During the migration, some nodes were restarted due to running out of memory, as migration memory usage peaked at **2-3x normal usage (~40–42 GB)**.

#### Action Items for Validators / RPC Operators

- **Be aware that migration memory usage may reach ~40–42 GB.**  
  If running in environments with memory limits (e.g., Kubernetes), ensure your limits are configured appropriately to avoid OOM-kills during the migration phase.

- **Avoid restarts during the migration phase**, as any restart will cause the migration to begin again and significantly extend total upgrade time.

- **Note:** After all modules finish upgrading, block production will resume once quorum of validators by stake have completed the upgrade. Depending on validator response rate, this can add an additional **30–90 minutes** to the overall migration duration.
