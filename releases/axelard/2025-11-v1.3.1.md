# axelard v1.3.1

|                | **Owner**                             |
| -------------- | ------------------------------------- |
| **Created By** | @chipshort <christoph@interoplabs.io> |
| **Deployment** |                                       |

| **Network**          | **Deployment Status**     | **Date**           |
| -------------------- |---------------------------|--------------------|
| **Devnet Amplifier** | Pending update from 1.3.0 | 2025-11-24 (1.3.0) |
| **Stagenet**         | Pending update from 1.3.0 | 2025-11-25 (1.3.0) |
| **Testnet**          | -                         | TBD                |
| **Mainnet**          | -                         | TBD                |

[Release v1.3.1](https://github.com/axelarnetwork/axelar-core/releases/tag/v1.3.1)

## Background

### Changes since v1.2.4 (up to 1.3.0):

- Updates Cosmos SDK to v0.50, WasmD to v0.54, WasmVM to v2.2, CometBFT to v0.38, also updates various other dependencies.
- The governance module now uses the new message-based governance proposals
- Clients interacting with Axelar need to be updated to use the new protobuf messages. This includes ampd!
- Some of the Cosmos SDK modules include in-place storage migrations
- New `x/consensus` module has been added to the SDK, which is used to manage consensus parameters.
- Performance improvements: we're reducing the block time
- All block-based params have to be increased accordingly. Most have been [increased in a migration][param-pr],
  but some need to be updated after the upgrade.

### Additional changes in v1.3.1 (v1.3.1 is a drop-in replacement for v1.3.0 - no upgrade proposal required):
- **non-GMP-based mechanisms for token transfers such as transfer via linked deposit address and direct token transfers are being deprecated, should no longer be used and will stop working at some point in the near future**
- Reverted fast node config defaults to pre-1.3.0 values to avoid reindexing the entire state during migration (which would take hours)
- Removed broken CLI commands
- Updated additional parameter defaults based on devnet/stagenet experience running 1.3.0 with ~1s block times, including vald parameters

## Migrate CosmWasm Contracts

Migrate Multisig contract and all Voting Verifier contracts to increase poll/signing block expiry values to account for faster block times. See [Amplifier Contracts Migration Guide](../cosmwasm/2025-11-Cosmos-SDK-v0.50-amplifier-contracts-migration-guide.md).

## Deployment Steps for Axelar Maintainers

1. Submit upgrade proposal and vote on upgrade proposal. Roughly like this:

    ```bash
    axelard tx gov submit-proposal \
         software-upgrade "v1.3" \
         --upgrade-height $upgradeHeight \
         --deposit ${govProposalDepositAmount}uaxl \
         --description "This proposal is intended to upgrade axelar core to v1.3" \
         --title "Axelar v1.3" \
         --from validator --gas auto --gas-adjustment 1.2

     axelard tx gov vote ${proposalId} yes \
        --from validator --gas auto --gas-adjustment 1.5
    ```

2. Inform all validators about the upgrade and upgrade height.
3. Wait for proposal to pass.
4. When upgrade height is reached, follow the steps for Axelar Validators below to upgrade our nodes.


### Update Reward Pools

Update all reward pools to account for faster block time. See [Amplifier Contracts Migration Guide](../cosmwasm/2025-11-Cosmos-SDK-v0.50-amplifier-contracts-migration-guide.md).

### Ensure Cosmos SDK Version is updated in `axelar-contract-deployments` Config

[Example](https://github.com/axelarnetwork/axelar-contract-deployments/blob/e95530efba9cd1863375201ec6b4760004840951/axelar-chains-config/info/devnet-amplifier.json#L1814)

### Update Mint and Slashing module params

1.  Create proposal file

    | **Network**          | **mint_denom** | **blocks_per_year** | **old_blocks_per_year** | **downtime_jail_duration** | **deposit**         |
        | -------------------- | -------------- | ------------------- | ----------------------- | -------------------------- | ------------------- |
    | **Devnet Amplifier** | uamplifier     | 31557600            | 6311520                 | 600s                       | 100000000uamplifier |
    | **Stagenet**         | uaxl           | 31557600            | 6311520                 | 600s                       | 100000000uaxl       |
    | **Testnet**          | uaxl           | 27186205            | 5437241                 | 7200s                      | 2000000000uaxl      |
    | **Mainnet**          | uaxl           | 26725420            | 5345084                 | 7200s                      | 2000000000uaxl      |

    ```bash
    cat > proposal.json << 'EOF'
    {
    "messages": [
        {
        "@type": "/cosmos.mint.v1beta1.MsgUpdateParams",
        "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
        "params": {
            "mint_denom": "[mint_denom]",
            "inflation_rate_change": "0.000000000000000000",
            "inflation_max": "0.000000000000000000",
            "inflation_min": "0.000000000000000000",
            "goal_bonded": "0.670000000000000000",
            "blocks_per_year": "[blocks_per_year]"
        }
        },
        {
        "@type": "/cosmos.slashing.v1beta1.MsgUpdateParams",
        "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
        "params": {
            "signed_blocks_window": "175000",
            "min_signed_per_window": "0.500000000000000000",
            "downtime_jail_duration": "[downtime_jail_duration]",
            "slash_fraction_double_sign": "0.020000000000000000",
            "slash_fraction_downtime": "0.000100000000000000"
        }
        }
    ],
    "metadata": "",
    "deposit": "[deposit]",
    "title": "Update Mint and Slashing Parameters for SDK v0.50 Block Time",
    "summary": "Adjust blocks_per_year from [old_blocks_per_year] to [blocks_per_year] and signed_blocks_window from 35,000 to 175,000 to maintain correct timing after block time reduction from ~5s to ~1s following the SDK v0.50 upgrade."
    }
    EOF
    ```

1.  Submit proposal

    ```bash
    axelard tx gov submit-proposal proposal.json \
    --gas auto \
    --gas-adjustment 1.5
    ```

1.  Wait for proposal to pass and query module params
    ```bash
    axelard query mint params
    axelard query slashing params
    ```


### Post-Upgrade Checklist for Maintainers

- [ ] Testing
    - [ ] General testing: GMP calls, IBC transfers, key rotation
    - [ ] Ensure new `UpdateParams` message works in new message-based proposals as expected. To check this, submit a proposal to change a parameter for one of our modules.
    - [ ] Test Rosetta API is working. To do this, a rosetta checker needs to be spun up and run against one of the nodes. Haiyi and Steven can help with this.
- [ ] Post-Upgrade parameter updates:
    - [ ] Monitor actual block time in production to assess whether [block-based param updates][param-pr] were accurate or if we need to adjust them again.
    - [ ] Update the `slashing` module's `signed_blocks_window` according to the new block time (i.e. if block time is 5x lower, then `signed_blocks_window` should be 5x higher).
    - [ ] Update the `mint` module's `blocks_per_year` to the new value based on how fast the block production is.

[param-pr]: https://github.com/axelarnetwork/axelar-core/pull/2282

### Updating from v1.3.0 to v1.3.1

For networks already running v1.3.0 (devnet-amplifier, stagenet), a governance proposal is required to update the grace period parameters that were adjusted based on production experience:

| Module | Parameter | Old Value (v1.3.0) | New Value (v1.3.1) |
| ------ | --------- | ------------------ | ------------------ |
| `evm` (per chain) | `voting_grace_period` | `15` | `2` |
| `multisig` | `keygen_grace_period` | `50` | `3` |
| `multisig` | `signing_grace_period` | `50` | `3` |

Example proposal for updating multisig params (query current values with `axelard query multisig params`):

```bash
cat > proposal.json << 'EOF'
{
  "messages": [
    {
      "@type": "/axelar.multisig.v1beta1.UpdateParamsRequest",
      "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
      "params": {
        "keygen_threshold": "[CURRENT_VALUE]",
        "signing_threshold": "[CURRENT_VALUE]",
        "keygen_timeout": "[CURRENT_VALUE]",
        "keygen_grace_period": "3",
        "signing_timeout": "[CURRENT_VALUE]",
        "signing_grace_period": "3",
        "active_epoch_count": "[CURRENT_VALUE]"
      }
    }
  ],
  "metadata": "",
  "deposit": "[deposit]",
  "title": "Update Multisig Grace Periods for v1.3.1",
  "summary": "Reduce keygen_grace_period and signing_grace_period from 50 to 3 based on production experience with ~1s block times."
}
EOF
```

Example proposal for updating evm params for a single chain (query current values with `axelard query evm params [chain]`):

```bash
cat > proposal.json << 'EOF'
{
  "messages": [
    {
      "@type": "/axelar.evm.v1beta1.UpdateParamsRequest",
      "authority": "axelar10d07y265gmmuvt4z0w9aw880jnsr700j7v9daj",
      "params": {
        "chain": "[CHAIN_NAME]",
        "confirmation_height": "[CURRENT_VALUE]",
        "network": "[CURRENT_VALUE]",
        "networks": "[CURRENT_VALUE]",
        "voting_threshold": "[CURRENT_VALUE]",
        "min_voter_count": "[CURRENT_VALUE]",
        "commands_gas_limit": "[CURRENT_VALUE]",
        "voting_grace_period": "2",
        "end_blocker_limit": "[CURRENT_VALUE]",
        "transfer_limit": "[CURRENT_VALUE]",
        "revote_locking_period": "[CURRENT_VALUE]"
      }
    }
  ],
  "metadata": "",
  "deposit": "[deposit]",
  "title": "Update EVM Voting Grace Period for [CHAIN_NAME]",
  "summary": "Reduce voting_grace_period from 15 to 2 based on production experience with ~1s block times."
}
EOF
```

## Deployment Steps for Axelar Validators

### Prerequisites

- If building from source, use Go 1.25
- libwasmvm has been updated from `v1.5.8` to `v2.2.4`, make sure to update the dependency if you are using the `axelard` binary. Prebuilt binaries, including a statically linked linux binary that doesn't require libwasmvm on the system, are available on the `v1.3.1` [release page](https://github.com/axelarnetwork/axelar-core/releases/tag/v1.3.1)
- Prepare to [update ampd to 1.13.2] at the same time

[update ampd to 1.13.2]: ../ampd/2025-11-17-ampd-v1.13.2.md

### Upgrade Details by Network

| Network | Proposal | Upgrade Height | Upgrade Time (UTC) | Notes |
|---------|----------|----------------|-------------------|--------|
| **Testnet** | [404](https://testnet.axelarscan.io/proposal/404) | [22091980](https://www.mintscan.io/axelar-testnet/block/22091980) | TBD | Upgrade from v1.2.4 |
| **Mainnet** | TBD | TBD | TBD | Upgrade from v1.2.4 |

### Upgrade Process

1. Wait for upgrade height to be reached.
2. Stop the `axelard` node, `vald`, and `ampd` (if you are running a verifier).
3. Update `config.toml`:

   | Parameter | Old Value (v1.2.4) | New Value (v1.3.1) |
   | --------- | ------------------ | ------------------ |
   | `timeout_commit` | `5s` | `1s` |

4. Remove the following entries from your `vald` config to use the new defaults:
   - `max_blocks_behind_latest` (in root section)
   - `max_retries` (in `[broadcast]` section)
   - `min_sleep_before_retry` (in `[broadcast]` section)
   - `max_timeout` (in `[broadcast]` section)

5. Restart the `axelard` node, `vald`, and `ampd` with the new binaries.
6. If you are running a relayer (e.g. hermes), you might need to restart it as well.

### Post-Deployment Checklist

- [ ] Verify that nodes are producing new blocks after the upgrade.
- [ ] Verify vald is participating in message validation, signing, heartbeats etc.
- TODO: add e2e test instructions
- [ ] Test [GMP calls](../evm/EVM-GMP-Release-Template.md)

## Troubleshooting

### App Hash Error

If you encounter hash error ensure you have libwasm v2.2.4 which can be obtained from https://github.com/CosmWasm/wasmvm/releases/download/v2.2.4/libwasmvm.x86_64.so. Before restarting node:

1. Ensure system environment variable `LD_LIBRARY_PATH` is specified to correct location if using binary. For docker image no change is necessary.
