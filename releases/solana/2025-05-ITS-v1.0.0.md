# Solana ITS v1.0.0

|                | **Owner**                      |
| -------------- | ------------------------------ |
| **Created By** | @<GITHUB_USERNAME> (<EMAIL>)   |
| **Deployment** | @<GITHUB_USERNAME> (<EMAIL>)   |

| **Network**          | **Deployment Status** | **Date**         |
| -------------------- | --------------------- | ---------------- |
| **Devnet Amplifier** | Pending               | <DEPLOY_DATE>    |
| **Stagenet**         | Pending               | <DEPLOY_DATE>    |
| **Testnet**          | Pending               | <DEPLOY_DATE>    |
| **Mainnet**          | Pending               | <DEPLOY_DATE>    |

- [Release](<GITHUB_RELEASE_URL>)

## Background

This is the v1.0.0 Solana ITS release, bringing Interchain Token Service capabilities to the Solana blockchain.

## Deployment

### Prerequisites

Ensure that [Solana GMP](./2025-05-GMP-v1.0.0.md) is deployed first.

1. Clone the solana-axelar repository and checkout the appropriate version.

2. Build the Solana InterchainTokenService:

In order to get verifiable builds, we use `solana-verify` tool. Set the `BASE_IMAGE` variable:

```sh
export BASE_IMAGE="solanafoundation/solana-verifiable-build@sha256:979b09eef544de4502a92e28a724a8498a08e2fe506e8905b642e613760403d3"
```

```sh
# Go to the solana directory within the cloned repo
pushd solana-axelar/solana/

# Compile Solana InterchainTokenService
solana-verify build --base-image $BASE_IMAGE --library-name axelar_solana_its

# Go back
popd
```

4. Set up environment configuration:

Create an `.env` config. `CLUSTER` should be set to `mainnet-beta` when `ENV` is set to `mainnet`, and to `devnet` otherwise.

```yaml
ENV=<devnet-amplifier|stagenet|testnet|mainnet>
CLUSTER=<devnet|mainnet-beta>
```

#### Devnet-amplifier / Stagenet / Testnet

```sh
# Set default cluster
solana config set --url devnet

# Generate a new keypair if needed
solana-keygen new

# Get funds
solana airdrop 2
```

#### Mainnet

```sh
# Set default cluster
solana config set --url mainnet-beta

# Generate a new keypair if needed
solana-keygen new
```

In this case the wallet needs to be funded with real `SOL`.

### Deployment Steps

1. Declare enviroment variables:
```sh
ITS_PROGRAM_KEYPAIR_PATH=<path/to/its_program_keypair.json>
ITS_PROGRAM_PATH="solana-axelar/target/deploy/axelar_solana_its.so"
UPGRADE_AUTHORITY_KEYPAIR_PATH=<path/to/upgrade_authority_keypair.json>
```

1. Deploy Interchain Token Service:

```sh
solana program-v4 deploy --program-keypair $ITS_PROGRAM_KEYPAIR_PATH --authority $UPGRADE_AUTHORITY_KEYPAIR_PATH  $ITS_PROGRAM_PATH
```

2. Initialize ITS:

```sh
solana/solana-axelar-cli send its init --operator <ITS_OPERATOR_BASE58_PUBKEY>
```

4. Register Solana ITS on ITS Hub:

ITS hub contract configuration in `axelar-chains-config/info/<devnet-amplifier|stagenet|testnet|mainnet>.json` must include the following attributes per chain:

#### Devnet-amplifier / Stagenet / Testnet

```json
"axelar": {
  "contracts": {
    "InterchainTokenService": {
      "solana-devnet": {
        "maxUintBits": 64,
        "maxDecimalsWhenTruncating": 255
      }
    }
  }
}
```

#### Mainnet

```json
"axelar": {
  "contracts": {
    "InterchainTokenService": {
      "solana": {
        "maxUintBits": 64,
        "maxDecimalsWhenTruncating": 255
      }
    }
  }
}
```

Please refer to `$DEPOSIT_VALUE` and `$RUN_AS_ACCOUNT` from Amplifier deployment documentation.

- `--runAs $RUN_AS_ACCOUNT` is only required for devnet-amplifier. Do not use `--runAs` for testnet, or mainnet.
- For mainnet, add a community post for the proposal.

```sh
node cosmwasm/submit-proposal.js \
    its-hub-register-chains "solana" \
    -t "Register solana on ITS Hub" \
    -d "Register solana on ITS Hub" \
    --deposit $DEPOSIT_VALUE \
    --runAs $RUN_AS_ACCOUNT
```

5. Set up trusted chains on Solana:

```sh
# Add all trusted chains to Solana ITS
solana/solana-axelar-cli send its set-trusted-chain all
```

Alternatively, add specific chains:

```sh
# Add a specific trusted chain
solana/solana-axelar-cli send its set-trusted-chain <CHAIN_NAME>
```

6. Set Solana as trusted chain on EVM ITS and other chain ITS implementations:

```sh
# Set PRIVATE_KEY in .env
PRIVATE_KEY=<EVM_DEPLOYER_KEY>

node evm/its.js -n all --action setTrustedAddress --trustedChain <solana|solana-devnet> --trustedAddress hub
```

## Checklist

The following checks should be performed after the rollout.

### Execute Command

The GMP call needs to be routed via Amplifier and proof submited to the gateway before the `execute` call.

### Solana to EVM

- Note: The final execute step of the GMP call on EVM can be performed via:

```sh
# Change PRIVATE_KEY in .env to EVM
PRIVATE_KEY=<EVM_DEPLOYER_KEY>

node evm/gateway.js -n <DESTINATION_CHAIN> --action execute --payload <PAYLOAD> --sourceChain axelar --sourceAddress <ITS_HUB_ADDRESS> --messageId <MESSAGE_ID> --destination <DESTINATION_ADDRESS>
```

1. Deploy Native Interchain Token:

```sh
solana/solana-axelar-cli send its deploy-interchain-token \
  --salt <SALT_STRING> \
  --name <TOKEN_NAME> \
  --symbol <TOKEN_SYMBOL> \
  --decimals <DECIMALS> \
  --initial-supply <INITIAL_SUPPLY>

solana/solana-axelar-cli send its deploy-remote-interchain-token \
  --salt <SALT_STRING> \
  --destination-chain <DESTINATION_CHAIN_NAME> \
  --gas-value <GAS_VALUE>
```

2. Interchain Token Transfer for Native Interchain Token:

```sh
solana/solana-axelar-cli send its interchain-transfer \
  --source-account <SOURCE_ACCOUNT_ADDRESS> \
  --token-id <TOKEN_ID_HEX> \
  --destination-chain <DESTINATION_CHAIN_NAME> \
  --destination-address <DESTINATION_ADDRESS> \
  --amount <AMOUNT> \
  --mint <MINT_ADDRESS> \
  --token-program <TOKEN_PROGRAM> \
  --gas-value <GAS_VALUE>
```

3. Deploy Remote Canonical Token:

```sh
solana/solana-axelar-cli send its register-canonical-interchain-token \
  --mint <MINT_ADDRESS> \
  --token-program <TOKEN_PROGRAM>

solana/solana-axelar-cli send its deploy-remote-canonical-interchain-token \
  --mint <MINT_ADDRESS> \
  --destination-chain <DESTINATION_CHAIN_NAME> \
  --gas-value <GAS_VALUE>
```

4. Interchain Token Transfer for Canonical Token:

```sh
solana/solana-axelar-cli send its interchain-transfer \
  --source-account <SOURCE_ACCOUNT_ADDRESS> \
  --token-id <TOKEN_ID_HEX> \
  --destination-chain <DESTINATION_CHAIN_NAME> \
  --destination-address <DESTINATION_ADDRESS> \
  --amount <AMOUNT> \
  --mint <MINT_ADDRESS> \
  --token-program <TOKEN_PROGRAM> \
  --gas-value <GAS_VALUE>
```

### EVM to Solana

- Note: The final execute step of the GMP call on Solana can be performed via:

```sh
solana/solana-axelar-cli send gateway execute \
  --source-chain <SOURCE_CHAIN> \
  --message-id <MESSAGE_ID> \
  --source-address <SOURCE_ADDRESS> \
  --payload <PAYLOAD> \
  --destination <DESTINATION_ADDRESS>
```

1. Deploy Native Interchain Token:

```sh
node evm/interchainTokenFactory.js --action deployInterchainToken -n <SOURCE_CHAIN> --destinationChain <solana|solana-devnet> --salt <SALT> --name <TOKEN_NAME> --symbol <TOKEN_SYMBOL> --decimals <DECIMALS>

node evm/interchainTokenFactory.js --action deployRemoteInterchainToken -n <SOURCE_CHAIN> --destinationChain <solana|solana-devnet> --salt <SALT> --gasValue <GAS_VALUE>
```

2. Interchain Token Transfer for Native Interchain Token:

```sh
node evm/its.js --action interchainTransfer -n <SOURCE_CHAIN> --destinationChain <solana|solana-devnet> --destinationAddress <ENCODED_RECIPIENT> --tokenId <TOKEN_ID> --amount <AMOUNT>
```

3. Deploy Remote Canonical Token:

```sh
node evm/interchainTokenFactory.js --action registerCanonicalInterchainToken -n <SOURCE_CHAIN> --destinationChain <solana|solana-devnet> --tokenAddress <TOKEN_ADDRESS>

node evm/interchainTokenFactory.js --action deployRemoteCanonicalInterchainToken -n <SOURCE_CHAIN> --destinationChain <solana|solana-devnet> --tokenAddress <TOKEN_ADDRESS> --gasValue <GAS_VALUE>
```

4. Interchain Token Transfer for Canonical Token:

```sh
node evm/its.js --action interchainTransfer -n <SOURCE_CHAIN> --destinationChain <solana|solana-devnet> --destinationAddress <ENCODED_RECIPIENT> --tokenId <TOKEN_ID> --amount <AMOUNT> --gasValue <GAS_VALUE>
```
