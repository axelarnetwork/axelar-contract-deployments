# Solana GMP v1.0.0

|                | **Owner**                      |
| -------------- | ------------------------------ |
| **Created By** | @<GITHUB_USERNAME> (<EMAIL>)   |
| **Deployment** | @<GITHUB_USERNAME> (<EMAIL>)   |

| **Network**          | **Deployment Status** | **Date**         |
| -------------------- | --------------------- | ---------------- |
| **Devnet Amplifier** | Pending               | <DEPLOY_DATE>    |
| **Stagenet**         | Pending               | <DEPLOY_DATE>    |
| **Testnet**          | Pending               | <DEPLOY_DATE>    |
| **Mainnet**          | Pending               | <DEPLOY_DATE>    |

- [GitHub Release](<GITHUB_RELEASE_URL>)

## Background

This is the v1.0.0 Solana GMP release, introducing General Message Passing (GMP) capabilities for Solana blockchain.

## Deployment

### Prerequisites

1. Ensure you have Rust installed. If you don't:

```sh
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

2. Install Solana CLI:

```sh
sh -c "$(curl -sSfL https://release.anza.xyz/v2.2.14/install)"
```

3. Install `solana-verify`, for verifiable builds:

```sh
cargo install solana-verify --locked 0.4.4
```

4. Clone the solana-axelar repository and checkout the appropriate version.

5. Build the Solana programs:

In order to get verifiable builds, we use `solana-verify` tool. Set the `BASE_IMAGE` variable:

```sh
export BASE_IMAGE="solanafoundation/solana-verifiable-build@sha256:979b09eef544de4502a92e28a724a8498a08e2fe506e8905b642e613760403d3"
```

```sh
# Go to the solana directory within the cloned repo
pushd solana-axelar/

# Compile the Solana programs
solana-verify build --base-image $BASE_IMAGE --library-name axelar_solana_gateway
solana-verify build --base-image $BASE_IMAGE --library-name axelar_solana_gas_service
solana-verify build --base-image $BASE_IMAGE --library-name axelar_solana_governance
solana-verify build --base-image $BASE_IMAGE --library-name axelar_solana_multicall

# Go back
popd
```

6. Set up environment configuration:

Create an `.env` config. `CLUSTER` should be set to `mainnet-beta` when `ENV` is set to `mainnet`, and to `devnet` otherwise.

```yaml
ENV=<devnet-amplifier|stagenet|testnet|mainnet>
CLUSTER=<devnet|mainnet-beta>
```

#### Devnet-amplifier / Stagenet / Testnet

```sh
# Set default cluster
solana config set --url devnet

# Generate a new keypair if needed
solana-keygen new

# Get funds
solana airdrop 2
```

#### Mainnet

```sh
# Set default cluster
solana config set --url mainnet-beta

# Generate a new keypair if needed
solana-keygen new
```

In this case the wallet needs to be funded with real `SOL`.

### Initial Solana Config

Add Solana chain config to the `axelar-chains-config/info/<devnet-amplifier|stagenet|testnet|mainnet>.json` file under the `chains` key.

#### Devnet-amplifier / Stagenet/ Testnet

```json
"solana": {
  "name": "Solana Devnet",
  "axelarId": "solana-devnet",
  "rpc": "https://api.devnet.solana.com",
  "chainType": "svm",
  "decimals": 9,
  "finality": "31",
  "approxFinalityWaitTime": 1,
  "tokenSymbol": "SOL",
  "explorer": {
    "name": "Solana Explorer",
    "url": "https://explorer.solana.com/?cluster=devnet"
  },
  "contracts": {}
}
```

#### Mainnet:

```json
"solana": {
  "name": "Solana",
  "axelarId": "solana",
  "rpc": "https://api.mainnet-beta.solana.com",
  "chainType": "svm",
  "decimals": 9,
  "finality": "31",
  "approxFinalityWaitTime": 1,
  "tokenSymbol": "SOL",
  "explorer": {
    "name": "Solana Explorer",
    "url": "https://explorer.solana.com/"
  },
  "contracts": {}
}
```

### Deployment Steps

1. Declare enviroment variables:
```sh
GATEWAY_PROGRAM_KEYPAIR_PATH=<path/to/gateway_program_keypair.json>
GATEWAY_PROGRAM_PATH="solana-axelar/target/deploy/axelar_solana_gateway.so"

GAS_SERVICE_PROGRAM_KEYPAIR_PATH=<path/to/gas_service_program_keypair.json>
GAS_SERVICE_PROGRAM_PATH="solana-axelar/target/deploy/axelar_solana_gas_service.so"

GOVERNANCE_PROGRAM_KEYPAIR_PATH=<path/to/governance_program_keypair.json>
GOVERNANCE_PROGRAM_PATH="solana-axelar/target/deploy/axelar_solana_governance.so"

MULTICALL_PROGRAM_KEYPAIR_PATH=<path/to/multicall_program_keypair.json>
MULTICALL_PROGRAM_PATH="solana-axelar/target/deploy/axelar_solana_multicall.so"

UPGRADE_AUTHORITY_PUBKEY=<base58 pubkey to set as upgrade authority>
```

2. Deploy and verify Gateway program:

```sh
solana program-v4 deploy --program-keypair $GATEWAY_PROGRAM_KEYPAIR_PATH --authority $UPGRADE_AUTHORITY_PUBKEY $GATEWAY_PROGRAM_PATH


solana-verify verify-from-repo --remote --base-image $BASE_IMAGE --commit-hash $COMMIT_HASH --program-id $(solana address -k $GATEWAY_PROGRAM_KEYPAIR_PATH) https://github.com/eigerco/solana-axelar
```

3. Deploy and verify Gas Service program:

```sh
solana program-v4 deploy --program-keypair $GAS_SERVICE_PROGRAM_KEYPAIR_PATH --authority $UPGRADE_AUTHORITY_PUBKEY $GAS_SERVICE_PROGRAM_PATH

solana-verify verify-from-repo --remote --base-image $BASE_IMAGE --commit-hash $COMMIT_HASH --program-id $(solana address -k $GAS_SERVICE_PROGRAM_KEYPAIR_PATH) https://github.com/eigerco/solana-axelar
```

4. Deploy and verify Governance program:

```sh
solana program-v4 deploy --program-keypair $GOVERNANCE_PROGRAM_KEYPAIR_PATH --authority $UPGRADE_AUTHORITY_PUBKEY $GOVERNANCE_PROGRAM_PATH

solana-verify verify-from-repo --remote --base-image $BASE_IMAGE --commit-hash $COMMIT_HASH --program-id $(solana address -k $GOVERNANCE_PROGRAM_KEYPAIR_PATH) https://github.com/eigerco/solana-axelar
```

5. Deploy Multicall program:

```sh
solana program-v4 deploy --program-keypair $MULTICALL_PROGRAM_KEYPAIR_PATH --authority $UPGRADE_AUTHORITY_PUBKEY $MULTICALL_PROGRAM_PATH

solana-verify verify-from-repo --remote --base-image $BASE_IMAGE --commit-hash $COMMIT_HASH --program-id $(solana address -k $MULTICALL_PROGRAM_KEYPAIR_PATH) https://github.com/eigerco/solana-axelar
```

6. After deploying Solana contracts, deploy the [Solana GMP Amplifier](../cosmwasm/2025-05-Solana-GMP-v1.0.0.md).

### Initialization Steps

1. Initialize Gateway:

| Network              | `minimumRotationDelay` | `previousSignersRetention` |
| -------------------- | ---------------------- | -------------------------- |
| **Devnet-amplifier** | `0`                    | `15`                       |
| **Stagenet**         | `300`                  | `15`                       |
| **Testnet**          | `3600`                 | `15`                       |
| **Mainnet**          | `86400`                | `15`                       |


```sh
solana/solana-axelar-cli send gateway init \
  --previous-signers-retention 15 \
  --minimum-rotation-delay <DELAY_IN_SECONDS> \
  --operator <OPERATOR_BASE58_PUBKEY>
```

This will query the `MultisigProver` for the `VerifierSet`. Thus, the Solana `MultisigProver` must be deployed before this step and its information available within the appropriate object in the `axelar-chains-config/info/<devnet-amplifier|testnet|mainnet>.json` file.

2. Initialize Gas Service:

```sh
solana/solana-axelar-cli send gas-service init \
  --authority <CONFIG_AUTHORITY_BASE58_PUBKEY> \
  --salt <SALT_STRING>
```

3. Initialize Governance:

```sh
solana/solana-axelar-cli send governance init \
    --governance-chain <GOVERNANCE_CHAIN> \
    --governance-address <GOVERNANCE_ADDRESS> \
    --minimum-proposal-eta-delay <MINIMUM_PROPOSAL_ETA_DELAY_IN_SECONDS> \
    --operator <GOVERNANCE_PROGRAM_OPERATOR_BASE58_PUBKEY>
```

## Checklist

The following checks should be performed after the rollout:

### Verify Solana → EVM GMP call

1. Send a GMP call:

```sh
solana/solana-axelar-cli send gateway call-contract \
  --destination-chain <DESTINATION_CHAIN_NAME> \
  --destination-address <DESTINATION_ADDRESS> \
  --payload <MESSAGE_PAYLOAD_HEX>
```

2. Get the event index using the previous transaction signature from the previous step. You should look for the index of the `CallContract` event:

```sh
solana/solana-axelar-cli query gateway events <SIGNATURE>
```

3. Route GMP call via Amplifier using the event index from the previous step as `TX_EVENT`:

- <https://docs.axelar.dev/dev/amplifier/chain-integration/relay-messages>

4. Submit proof with multisig session ID:

```sh
# Change `PRIVATE_KEY in `.env` to EVM
PRIVATE_KEY=<EVM_DEPLOYER_KEY>

node evm/gateway.js -n <DESTINATION_CHAIN> --action submitProof --multisigSessionId <MULTISIG_SESSION_ID>
```

5. Confirm message approval:

```sh
node evm/gateway.js -n <DESTINATION_CHAIN> --action isContractCallApproved --commandID <COMMAND_ID> --sourceChain <solana|solana-testnet|solana-devnet> --sourceAddress <SOURCE_ADDRESS> --destination <DESTINATION_ADDRESS> --payloadHash <PAYLOAD_HASH>
```

### Verify EVM → Solana GMP Call

1. Send a GMP call:

```sh
node evm/gateway.js -n <SOURCE_CHAIN> --action callContract --destinationChain <solana|solana-testnet|solana-devnet> --destination <DESTINATION_ADDRESS> --payload <PAYLOAD_HEX>
```

2. Route GMP call via Amplifier:

- <https://docs.axelar.dev/dev/amplifier/chain-integration/relay-messages>

3. Submit proof with multisig session ID:

```sh
solana/solana-axelar-cli send gateway submit-proof \
  --multisig-session-id <MULTISIG_SESSION_ID>
```

4. Confirm the message has been approved:

```sh
solana/solana-axelar-cli query gateway message-status <SOURCE_CHAIN> <MESSAGE_ID>
```

You should see:

```
Message Status: Approved
```
