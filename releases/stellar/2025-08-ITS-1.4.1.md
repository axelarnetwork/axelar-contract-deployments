# Stellar ITS v1.4.1

|                | **Owner**                        |
| -------------- | -------------------------------- |
| **Created By** | @ahramy (<ahram@interoplabs.io>) |
| **Deployment** | @ahramy (<ahram@interoplabs.io>) |

| **Network**  | **Deployment Status** | **Date**   |
| ------------ | --------------------- | ---------- |
| **Stagenet** | Completed             | 2025-08-27 |
| **Testnet**  | Completed             | 2025-08-27 |
| **Mainnet**  | Completed             | 2025-08-27 |

- [Crates](https://crates.io/crates/stellar-interchain-token-service/1.4.1)
- [Releases](https://github.com/axelarnetwork/axelar-amplifier-stellar/releases/tag/stellar-interchain-token-service-v1.4.1)

## Background

- This is the v1.4.1 Stellar ITS release which includes a fix to add mint/burn functionality when receiving messages from the hub.

- Please reference [stellar/docs/link-token.md](../stellar/docs/link-token.md) for more details.

## Deployment

Create an `.env` config. `CHAIN` should be set to `stellar` for mainnet, and `stellar-2025-q3` for stagenet and testnet.

```yaml
# Change `PRIVATE_KEY in `.env` to Stellar
PRIVATE_KEY=<stellar_deployer_key>
ENV=<stagenet|testnet|mainnet>
CHAIN=<stellar-2025-q3|stellar>
```

#### Contract Version Info

| Contract                 | ** Stagenet / Testnet / Mainnet ** |
| ------------------------ | ---------------------------------- |
| `InterchainTokenService` | `1.4.1`                            |

1. Verify deployer address

| Network      | `deployer address`                                         |
| ------------ | ---------------------------------------------------------- |
| **Stagenet** | `GBP4FSAOFV5O72AB3YQRDCYVD47W4N7KQK3OJODXSU3OBPNGKX4SQTJ3` |
| **Testnet**  | `GA6HQ5Z4O6T3MFYDC4MIJSYOIGSX2HYMZ5V6DI3NRBNIL7JX7A7IEO5Z` |
| **Mainnet**  | `GC2SJ4YXCMP2LYXMXBNJMK6SNK4XUR7TGJXY4GA3VACNMCZVCQ6VFGG3` |

2. Upgrade `InterchainTokenService`

For mainnet deployment, please use this specific commit (due to mainnet still running Stellar Protocol V22). For other networks (stagenet and testnet), use the main branch

```
git checkout 9cb6fb62733feb07da59a49b851a46d3dbb107fa # Stellar Protocol Pre-v23 commit

npm install; npm ci;
```

```bash
ts-node stellar/deploy-contract upgrade InterchainTokenService --version 1.4.1
```

## Checklist

The following checks should be performed after the rollout

Link a token on EVM as source chain (MINT_BURN) with a stellar custom token on Stellar as dest chain (MINT_BURN_FROM)

```bash
NAME="TEST"
SYMBOL="TEST"
SALT=0x1234
EVM_CHAIN=flow
STELLAR_CHAIN="stellar-2025-q3"  # Use "stellar-2025-q3" for stagenet/testnet or "stellar" for mainnet
STELLAR_TOKEN_ADMIN="STELLAR_TOKEN_ADMIN_ADDRESS"

# Deploy a custom token with 7 decimals on Stellar
stellar contract deploy --wasm target/wasm32-unknown-unknown/release/stellar_custom_token_example.wasm --source wallet --network testnet -- --admin $STELLAR_TOKEN_ADMIN --decimal 7 --name $NAME --symbol $SYMBOL

# Set STELLAR_TOKEN_ADDRESS from the result
STELLAR_TOKEN_ADDRESS=

# Register the token metadata on Stellar
ts-node stellar/its register-token-metadata $STELLAR_TOKEN_ADDRESS --gas-amount 10000000

# Deploy a token with 18 decimals on EVM
ts-node evm/interchainTokenFactory --action deployInterchainToken --minter 0xba76c6980428A0b10CFC5d8ccb61949677A61233 --name $NAME --symbol $SYMBOL --decimals 18 --initialSupply 10000000 --salt $SALT -n $EVM_CHAIN

# Set EVM_TOKEN_ADDRESS and EVM_TOKEN_ID from the result
EVM_TOKEN_ADDRESS=
EVM_TOKEN_ID=

# Register the token metadata on EVM
ts-node evm/its register-token-metadata $EVM_TOKEN_ADDRESS -n $EVM_CHAIN --gasValue 1000000000000000000

# Register Custom Token on EVM
MINT_BURN_TYPE=4
ts-node evm/interchainTokenFactory --action registerCustomToken --tokenAddress $EVM_TOKEN_ADDRESS --tokenManagerType $MINT_BURN_TYPE --operator 0xba76c6980428A0b10CFC5d8ccb61949677A61233 --salt $SALT -n $EVM_CHAIN -y

# Link Token
MINT_BURN_FROM_TYPE=1
ts-node evm/interchainTokenFactory --action linkToken --destinationChain $STELLAR_CHAIN --destinationTokenAddress $STELLAR_TOKEN_ADDRESS --tokenManagerType $MINT_BURN_FROM_TYPE --linkParams "0x" --salt $SALT -n $EVM_CHAIN --gasValue 10000000000000000000 -y

# Set TOKEN_ID from the result
TOKEN_ID=

# Get token manager address on EVM
ts-node evm/its token-manager-address $TOKEN_ID -n $EVM_CHAIN -y

# Set EVM_TOKEN_MANAGER from the result
EVM_TOKEN_MANAGER=

# Transfer mintership to the token manager
ts-node evm/its transfer-mintership $EVM_TOKEN_ADDRESS $EVM_TOKEN_MANAGER -n $EVM_CHAIN -y

# Get token manager address on Stellar
ts-node stellar/its deployed-token-manager $TOKEN_ID -y

# Set STELLAR_TOKEN_MANAGER from the result
STELLAR_TOKEN_MANAGER=

# Add the token manager as a minter
ts-node stellar/token-utils add-minter $STELLAR_TOKEN_ADDRESS $STELLAR_TOKEN_MANAGER

# Set User address
USER=  # Replace with your user address

# Mint token to the user
ts-node stellar/token-utils mint $STELLAR_TOKEN_ADDRESS $USER 10000000000

# Check balance of the token for the user
ts-node stellar/token-utils balance $STELLAR_TOKEN_ADDRESS $USER

# Interchain Transfer from Stellar to EVM
ts-node stellar/its interchain-transfer $TOKEN_ID $EVM_CHAIN <destinationAddress> 1 --gas-amount 10000000

# Interchain Transfer from EVM to Stellar
ts-node evm/its interchain-transfer $STELLAR_CHAIN $TOKEN_ID $USER 1 -n $EVM_CHAIN

# Check balance of the token for the user
ts-node stellar/token-utils balance $STELLAR_TOKEN_ADDRESS $USER
```
