# Stellar ITS v1.0.0

|                | **Owner**                            |
| -------------- | ------------------------------------ |
| **Created By** | @ahramy <ahram@interoplabs.io>       |
| **Deployment** | @RiceAndMeet <steven@interoplabs.io> |

| **Network**          | **Deployment Status** | **Date** |
| -------------------- | --------------------- | -------- |
| **Devnet Amplifier** | -                     | TBD      |
| **Stagenet**         | -                     | TBD      |
| **Testnet**          | -                     | TBD      |
| **Mainnet**          | -                     | TBD      |

- [Crates](https://crates.io/crates/stellar-interchain-token-service/1.0.0)
- [Releases](https://github.com/axelarnetwork/axelar-cgp-stellar/releases/tag/stellar-interchain-token-service-v1.0.0)

## Background

1. This is the MVP Stellar ITS release.

## Deployment

Ensure that [Stellar GMP](../stellar/2025-01-GMP-v1.0.0.md) is deployed first.

Create an `.env` config. `CHAIN` should be set to `stellar` for mainnet, and `stellar-2024-q4` for all other networks.

```yaml
PRIVATE_KEY=xyz
ENV=xyz
CHAIN=xyz
```

1. Deploy Interchain Token

```bash
node stellar/deploy-contract.js deploy interchain_token --version v1.0.0
```

2. Deploy Token Manager

```bash
node stellar/deploy-contract.js deploy token_manager --version v1.0.0
```

3. Deploy Interchain Token Service

- Ensure that `initializeArgs` are correct in `$ENV.json` after deployment.

```bash
node stellar/deploy-contract.js deploy interchain_token_service --version v1.0.0
```

4. Re-deploy Example with ITS support

```bash
node stellar/deploy-contract.js deploy example --version v1.0.0
```

5. Register Stellar ITS on ITS Hub

| Network              | `max_decimals_when_truncating` | `max_uint`            |
| -------------------- | ------------------------------ | --------------------- |
| **Devnet-amplifier** | `7`                            | `9223372036854775807` |
| **Stagenet**         | `7`                            | `9223372036854775807` |
| **Testnet**          | `7`                            | `9223372036854775807` |
| **Mainnet**          | `7`                            | `9223372036854775807` |

```bash
ITS_HUB_ADDR=$(cat ./axelar-chains-config/info/$ENV.json | jq -rM '.axelar.contracts.InterchainTokenService.address')
ITS_STELLAR_ADDR=$(cat ./axelar-chains-config/info/$ENV.json | jq -rM ".chains.\"$CHAIN\".contracts.interchain_token_service.address')

axelard tx wasm execute "$ITS_HUB_ADDR" \
'{
  "register_chains": {
    "chains": [
      {
        "chain": \"$CHAIN\",
        "its_edge_contract": \"$ITS_STELLAR_ADDR\",
        "truncation": {
          "max_decimals_when_truncating": "7",
          "max_uint": "9223372036854775807"
        }
      }
    ]
  }
}' \
--from <name-of-your-wasm-deployer-key> \
--gas auto \
--gas-adjustment 1.2
```

| Network              | `maxUintBits` | `maxDecimalsWhenTruncating` |
| -------------------- | ------------- | --------------------------- |
| **Devnet-amplifier** | `64`          | `7`                         |
| **Stagenet**         | `64`          | `7`                         |
| **Testnet**          | `64`          | `7`                         |
| **Mainnet**          | `64`          | `7`                         |

ITS hub contract configuration in json file must include the following attributes per chain:

```bash
"axelar": {
  "contracts": {
    ...
    "InterchainTokenService": {
      ...
      \"$CHAIN\": {
        "maxUintBits": 64,
        "maxDecimalsWhenTruncating": 7
      }
    }
    ...
  }
}
```

```bash
node cosmwasm/submit-proposal.js its-hub-register-chains $CHAIN -t "Proposal title" -d "Proposal description" --deposit $DEPOSIT_AMOUNT
```

5. Setting up trusted chains on Stellar

```bash
# Add all trusted chains to Stellar ITS
node stellar/its.js add-trusted-chains all
```

6. Set Stellar as trusted chain on EVM ITS. Similarly, set Stellar as a trusted chain for every other non EVM ITS contract

```bash
# Change `PRIVATE_KEY` in `.env` from stellar to EVM
node evm/its.js -n all --action setTrustedAddress --trustedChain stellar --trustedAddress hub
```

## Checklist

The following checks should be performed after the rollout

```bash
ITS_HUB_ADDRESS=its_hub_addres
WALLET=wallet_address
```

### Stellar to EVM

1. Deploy Native Interchain Token

```bash
node stellar/its.js deploy-interchain-token TEST test 18 0x1234 10000

node stellar/its.js deploy-remote-interchain-token 0x1234 [destination-chain]

node evm/gateway.js -n [destination-chain] --action execute --payload $PAYLOAD --sourceChain axelar --sourceAddress $ITS_HUB_ADDRESS --messageId [message-id] --destination $WALLET
```

2. Interchain Token Transfer for Native Interchain Token

```bash
node stellar/its.js interchain-transfer 0xa98974cd02e5ee3d65bff69465a00917f27176bffd72e352c11a78c7a999bded [destination-chain] $WALLET 1

node evm/gateway.js -n [destination-chain] --action execute --payload $PAYLOAD --sourceChain axelar --sourceAddress $ITS_HUB_ADDRESS --messageId [message-id] --destination $WALLET
```

3. Deploy Remote Canonical Token

```bash
node stellar/its.js register-canonical-token CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC

node stellar/its.js deploy-remote-canonical-token $GAS_TOKEN_ADDRESS [destination-chain]

node evm/gateway.js -n [destination-chain] --action execute --payload $PAYLOAD --sourceChain axelar --sourceAddress $ITS_HUB_ADDRESS --messageId [message-id] --destination $WALLET
```

4. Interchain Token Transfer for Canonical Token

```bash
node stellar/its.js interchain-transfer 0xa98974cd02e5ee3d65bff69465a00917f27176bffd72e352c11a78c7a999bded [destination-chain] $WALLET 1

node evm/gateway.js -n [destination-chain] --action execute --payload $PAYLOAD --sourceChain axelar --sourceAddress $ITS_HUB_ADDRESS --messageId [message-id] --destination $WALLET
```

### EVM to Stellar

1. Deploy Native Interchain Token

```bash
node evm/interchainTokenFactory.js --action deployInterchainToken -n [destination-chain] --destinationChain stellar --salt "salt" --name "test" --symbol "test" --decimals 18

node evm/interchainTokenFactory.js --action deployRemoteInterchainToken -n [destination-chain] --destinationChain stellar --salt "salt"

node stellar/its.js execute [destination-chain] [message-id] [source-address] [payload]
```

2. Interchain Token Transfer for Native Interchain Token

```bash
node evm/its.js --action interchainTransfer -n [destination-chain]  --destinationChain stellar --destinationAddress [destination-address] --tokenId [token-id] --amount 1

node stellar/its.js execute [destination-chain] [message-id] [source-address] [payload]
```

3. Deploy Remote Canonical Token

```bash
node evm/interchainTokenFactory.js --action registerCanonicalInterchainToken -n [destination-chain] --destinationChain stellar --tokenAddress [token-address]

node evm/interchainTokenFactory.js --action deployRemoteCanonicalInterchainToken -n [destination-chain] --destinationChain stellar --originalChain [original-chain] --tokenAddress [token-address]

node stellar/its.js execute [destination-chain] [message-id] [source-address] [payload]
```

4. Interchain Token Transfer for Canonical Token

```bash
node evm/its.js --action interchainTransfer -n [destination-chain] --destinationChain stellar --destinationAddress [destination-address] --tokenId [token-id] --amount 1

node stellar/its.js execute [destination-chain] [message-id] [source-address] [payload]
```
