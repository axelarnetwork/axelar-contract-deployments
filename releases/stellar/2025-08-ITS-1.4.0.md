# Stellar ITS v1.4.0

|                | **Owner**                        |
| -------------- | -------------------------------- |
| **Created By** | @ahramy (<ahram@interoplabs.io>) |
| **Deployment** | @ahramy (<ahram@interoplabs.io>) |

| **Network**  | **Deployment Status** | **Date** |
| ------------ | --------------------- | -------- |
| **Stagenet** | TBD                   | TBD      |
| **Testnet**  | TBD                   | TBD      |
| **Mainnet**  | TBD                   | TBD      |

- [Crates](https://crates.io/crates/stellar-interchain-token-service/1.4.0)
- [Releases](https://github.com/axelarnetwork/axelar-amplifier-stellar/releases/tag/stellar-interchain-token-service-v1.4.0)

## Background

- This is the v1.4.0 Stellar ITS release which supports custom token linking.

The token linking feature enables:

- Linking custom tokens deployed on Stellar with tokens on all other chains supported by the Axelar Network.
- Supporting tokens with different decimal precisions through automatic scaling. Please reference [stellar/docs/link-token.md](../stellar/docs/link-token.md) for more details.

## Deployment

Create an `.env` config. `CHAIN` should be set to `stellar` for mainnet, and `stellar-2025-q3` for stagenet and testnet.

```yaml
# Change `PRIVATE_KEY in `.env` to Stellar
PRIVATE_KEY=<stellar_deployer_key>
ENV=<stagenet|testnet|mainnet>
CHAIN=<stellar-2025-q3|stellar>
```

#### Contract Version Info

| Contract                 | ** Stagenet, Testnet ** | ** Mainnet** |
| ------------------------ | ----------------------- | ------------ |
| `InterchainTokenService` | `1.4.0`                 | `1.4.0`      |

Set `$VERSION` to the appropriate version from the table above for your target environment.

1. Verify deployer address

| Network      | `deployer address`                                         |
| ------------ | ---------------------------------------------------------- |
| **Stagenet** | `GBP4FSAOFV5O72AB3YQRDCYVD47W4N7KQK3OJODXSU3OBPNGKX4SQTJ3` |
| **Testnet**  | `GA6HQ5Z4O6T3MFYDC4MIJSYOIGSX2HYMZ5V6DI3NRBNIL7JX7A7IEO5Z` |
| **Mainnet**  | `GC2SJ4YXCMP2LYXMXBNJMK6SNK4XUR7TGJXY4GA3VACNMCZVCQ6VFGG3` |

2. Upgrade `InterchainTokenService`

```bash
ts-node stellar/deploy-contract upgrade InterchainTokenService --version 1.4.0
```

## Checklist

The following checks should be performed after the rollout:
Link a token on EVM(LOCK_UNLOCK) with your custom token on Stellar (MINT_BURN)

```bash
# Deploy a token with 18 decimals on EVM
ts-node evm/interchainTokenFactory --action deployInterchainToken --minter 0xba76c6980428A0b10CFC5d8ccb61949677A61233 --name "TestD18" --symbol "TestD18" --decimals 18 --initialSupply 10000000 --salt 0x1234 -n avalanche

# Register the token metadata on EVM
ts-node evm/its register-token-metadata <tokenAddress> -n avalanche --gasValue 1000000000000000000

# change trust to create a new stellar classic asset
ts-node stellar/token-utils change-trust <symbol> <issuer> 1000000000

# create a contract from stellar classic asset
ts-node stellar/token-utils create-stellar-asset-contract <symbol> <issuer>

# Register the token metadata on Stellar
ts-node stellar/its register-token-metadata <tokenAddress> --gas-amount 10000000

# Verify token metadata is registered on ITS Hub
ts-node cosmwasm/query token-config <chainName> <tokenId>

# Register Custom Token
ts-node stellar/its register-custom-token 0x1234 <tokenAddress> MINT_BURN

# Link Token
ts-node stellar/its link-token 0x1234 avalanche <tokenId> LOCK_UNLOCK --gas-amount 10000000

# Get token manager address
ts-node stellar/its deployed-token-manager <tokenId>

# Transfer admin to the token manager
ts-node stellar/token-utils set-admin <tokenAddress> <tokenManagerAddress>

# Interchain Transfer
ts-node stellar/its interchain-transfer <tokenId> avalanche <destinationAddress> 1 --gas-amount 10000000
```
