# STELLAR GMP v1.0.0

|                | **Owner**                            |
| -------------- | ------------------------------------ |
| **Created By** | @ahramy <ahram@interoplabs.io>       |
| **Deployment** | @RiceAndMeet <steven@interoplabs.io> |

| **Network**          | **Deployment Status** | **Date** |
| -------------------- | --------------------- | -------- |
| **Devnet Amplifier** | -                     | TBD      |
| **Stagenet**         | -                     | TBD      |
| **Testnet**          | -                     | TBD      |
| **Mainnet**          | -                     | TBD      |

- [Crates](https://crates.io/users/interoplabs-ci)
- [Releases](https://github.com/axelarnetwork/axelar-cgp-stellar/releases)

## Background

Changes in the release:

1. This is the v1.0.0 initial GMP release.

## Deployment

Create an `.env` config.

```yaml
PRIVATE_KEY=xyz
ENV=xyz
CHAIN=stellar
```

Deploy Stellar Gateway

```bash
# Deploy Gateway
[1] node stellar/deploy-contract.js deploy axelar_gateway --version v1.0.0
```

[2] After deploying the Stellar Gateway, ensure that you [deploy CosmWasm for Stellar GMP v1.0.0](../cosmwasm/2025-01-STELLAR-GMP-v1.0.0.md).

- Once all steps are completed, update ampd with the Stellar chain configuration, then follow the remaining steps.

```bash
# Rotate genesis verifier set on Stellar Gateway
[3] node stellar/gateway.js rotate --chain-name $CHAIN

# Deploy Gas Service
[4] node stellar/deploy-contract.js deploy axelar_gas_service --version v1.0.0

# Deploy Operators
[5] node stellar/deploy-contract.js deploy axelar_operators --version v1.0.0

# Register refunder address as an operator
[6] node stellar/operators.js --action add_operator --chain-name $CHAIN -e devnet-amplifier --args $REFUNDER_ADDRESS

# Deploy Example with dummy ITS address
[7] node stellar/deploy-contract.js deploy example --version v1.0.0 --use-dummy-its-address

```

## Checklist

The following checks should be performed after the rollout

```bash
alias axd='kubectl exec -it genesis-0 -n $ENV -- axelard'
ARGS=(--from amplifier --gas auto --gas-adjustment 1.4)
```

- [ ] Stellar → EVM GMP call

```bash
node stellar/gmp.js send avalanche 0x0FCb262571be50815627C16Eca1f5F3D342FF5a5 0x1234 CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC 1

axd tx wasm execute $GATEWAY '{"verify_messages":
      [{"cc_id":{
        "source_chain":"'"$CHAIN"'",
        "message_id":"0x7b903beabbf200f7408c8c46cc4e5281396fff68f718515984ad6481f563be2b-0"},
        "destination_chain":"avalanche",
        "destination_address":"0xba76c6980428A0b10CFC5d8ccb61949677A61233","source_address":"GALITAYSFTLEVXIBTF5FVUIV7PFVF7VF5VSZVFYCXA7PXSZ2LZMY54VG","payload_hash":"56570de287d73cd1cb6092bb8fdee6173974955fdef345ae579ee9f475ea7432"}]
    }' $ARGS

axd tx wasm execute $GATEWAY '{"route_messages":
      [{"cc_id":{
        "source_chain":"'"$CHAIN"'",
        "message_id":"0x7b903beabbf200f7408c8c46cc4e5281396fff68f718515984ad6481f563be2b-0"},
        "destination_chain":"avalanche",
        "destination_address":"0xba76c6980428A0b10CFC5d8ccb61949677A61233","source_address":"GAIA45FE43FHCKPK5A2RYBDTYG3D3TT3F3KHFWGWX53TH7FIMBK6LRSJ","payload_hash":"56570de287d73cd1cb6092bb8fdee6173974955fdef345ae579ee9f475ea7432"}]
    }' $ARGS

# Change private key and env from Stellar to EVM
axd tx wasm execute $PROVER '"'"'{"construct_proof":[{"source_chain":"'"$CHAIN"'","message_id":"0xee9f59136fd961ff6494da0ae4fbb8a4fc973a55c4f11543ef430c6f177866ff-0"}]}'"'"' --gas auto --gas-adjustment 3 -b block --from validator

node evm/gateway.js -n avalanche --action submitProof --multisigSessionId 3

node ./evm/gateway.js -n avalanche --action execute --commandID 0x934F10D2DABE8AADB12EB4D0D10CBB3D3124DAB7B4165B65AF537EBF0197402E --sourceChain avalanche --sourceAddress 0x0FCb262571be50815627C16Eca1f5F3D342FF5a5 --destination 0x0FCb262571be50815627C16Eca1f5F3D342FF5a5 --payload 0x1234
```

- [ ] EVM → Stellar GMP call

```bash
node evm/gateway.js -n avalanche --action callContract --destinationChain stellar --destination CCAZD6NDVKGZ5XE7UD3PZWJTJY45V7YY22XGPBUSUOEI7GQZLTPCXR7C --payload 0x1234

axd tx wasm execute $GATEWAY '{"verify_messages":
      [{"cc_id":{
        "source_chain":"avalanche", "message_id":"0x4c332c321fb039d017249de35640fb9768380f9dbd741fbcf56ea7245144588f-0"},
        "destination_chain":"'"$CHAIN"'",        "destination_address":"CCAZD6NDVKGZ5XE7UD3PZWJTJY45V7YY22XGPBUSUOEI7GQZLTPCXR7C",
        "source_address":"0xba76c6980428A0b10CFC5d8ccb61949677A61233",        "payload_hash":"56570de287d73cd1cb6092bb8fdee6173974955fdef345ae579ee9f475ea7432"}]
    }' $ARGS

axd tx wasm execute $GATEWAY '{"route_messages":
      [{"cc_id":{
        "source_chain":"avalanche",        "message_id":"0x4c332c321fb039d017249de35640fb9768380f9dbd741fbcf56ea7245144588f-0"},
        "destination_chain":"'"$CHAIN"'",        "destination_address":"CCAZD6NDVKGZ5XE7UD3PZWJTJY45V7YY22XGPBUSUOEI7GQZLTPCXR7C",
        "source_address":"0xba76c6980428A0b10CFC5d8ccb61949677A61233",        "payload_hash":"56570de287d73cd1cb6092bb8fdee6173974955fdef345ae579ee9f475ea7432"}]
    }' $ARGS

# Change private key and env from EVM to Stellar

axd tx wasm execute $PROVER '{"construct_proof":[{"source_chain":"avalanche","message_id":"0x4c332c321fb039d017249de35640fb9768380f9dbd741fbcf56ea7245144588f-0"}]}' $ARGS

node stellar/gateway.js submit-proof 1 --chain-name $CHAIN

node stellar/gmp.js execute avalanche '0x0bcbbfc9b006db6958f3fce75f11fdc306b45e8e43396211f414f40d2d6db7c5-0' 0xba76c6980428A0b10CFC5d8ccb61949677A61233 0x1234
```
