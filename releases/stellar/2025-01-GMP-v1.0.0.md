# STELLAR GMP v1.0.0

|                | **Owner**                            |
| -------------- | ------------------------------------ |
| **Created By** | @ahramy <ahram@interoplabs.io>       |
| **Deployment** | @RiceAndMeet <steven@interoplabs.io> |

| **Network**          | **Deployment Status** | **Date** |
| -------------------- | --------------------- | -------- |
| **Devnet Amplifier** | -                     | TBD      |
| **Stagenet**         | -                     | TBD      |
| **Testnet**          | -                     | TBD      |
| **Mainnet**          | -                     | TBD      |

- [Crates](https://crates.io/users/interoplabs-ci)
- [Releases](https://github.com/axelarnetwork/axelar-cgp-stellar/releases)

## Background

Changes in the release:

1. This is the v1.0.0 initial GMP release.

## Deployment

Create an `.env` config.

```yaml
PRIVATE_KEY=xyz
ENV=xyz
CHAIN=stellar-t1-2025-q1
```

```bash
# Deploy Gateway
node stellar/deploy-contract.js deploy axelar_gateway --version v1.0.0

# Instantiate stellar VotingVerifier
node ./cosmwasm/deploy-contract.js instantiate -c VotingVerifier -n stellar-t1-2025-q1 --fetchCodeId --instantiate2

# Instantiate stellar gateway
node ./cosmwasm/deploy-contract.js instantiate -c Gateway -n stellar-t1-2025-q1 --fetchCodeId --instantiate2

# Instantiate stellar MultisigProver
node ./cosmwasm/deploy-contract.js instantiate -c MultisigProver -n stellar-t1-2025-q1 --fetchCodeId --instantiate2

# Register stellar gateway at the Router
node cosmwasm/submit-proposal.js execute \
  -c Router \
  -t "Register Gateway for stellar-t1-2025-q1" \
  -d "Register Gateway address for stellar at Router contract" \
  --deposit 100000000 \
  --runAs axelar1zlr7e5qf3sz7yf890rkh9tcnu87234k6k7ytd9 \
  --msg '{"register_chain":{"chain":"stellar-t1-2025-q1","gateway_address":"axelar1yeglfarfc26ak3je4u6yvcuj0mfsyrp3zranrvn8vnfv370x6lyqkjl0kp","msg_id_format":"base58_tx_digest_and_event_index"}}'

# Register chain on ampd
for i in $(seq 0 4); do kubectl exec -it ampd-set-2-axelar-amplifier-worker-"$i" -n devnet-amplifier -c ampd -- ampd register-chain-support validators stellar-t1-2025-q1 ; done
for i in $(seq 0 4); do kubectl exec -it ampd-set-2-axelar-amplifier-worker-"$i" -n devnet-amplifier -c ampd -- ampd register-public-key ed25519 ; done

# Register_prover_contract on coordinator
node cosmwasm/submit-proposal.js execute \
  -c Coordinator \
  -t "Register Multisig Prover for stellar-t1-2025-q1" \
  -d "Register Multisig Prover address for stellar-t1-2025-q1 at Coordinator contract" \
  --deposit 100000000 \
  --runAs axelar1zlr7e5qf3sz7yf890rkh9tcnu87234k6k7ytd9 \
  --msg '{"register_prover_contract":{"chain_name":"stellar-t1-2025-q1","new_prover_addr":"axelar1umlvmydd6cuq3dskaa2xn2x24zt5fxx93ysxa2df6gr3l5ufsqrqp9465g"}}'

# Authorize_callers on multisig prover
node cosmwasm/submit-proposal.js execute \
  -c Multisig \
  -t "Authorize Multisig Prover for stellar-t1-2025-q1" \
  -d "Authorize Multisig Prover address for stellar-t1-2025-q1 at Multisig contract" \
  --runAs axelar1zlr7e5qf3sz7yf890rkh9tcnu87234k6k7ytd9 \
  --deposit 100000000 \
  --msg '{"authorize_callers":{"contracts":{"axelar1umlvmydd6cuq3dskaa2xn2x24zt5fxx93ysxa2df6gr3l5ufsqrqp9465g":"stellar-t1-2025-q1"}}}'

# Create verify reward pool
node cosmwasm/submit-proposal.js execute \
  -c Rewards \
  -t "Create pool for stellar in stellar voting verifier" \
  -d "Create pool for stellar in stellar voting verifier" \
  --runAs axelar1zlr7e5qf3sz7yf890rkh9tcnu87234k6k7ytd9 \
  --deposit 100000000 \
  --msg '{
  "create_pool": {
    "params": {
      "epoch_duration": "100",
      "participation_threshold": [
        "8",
        "10"
      ],
      "rewards_per_epoch": "100"
    },
    "pool_id": {
      "chain_name": "stellar-t1-2025-q1",
      "contract": "axelar1y6hjxuarlevd86kxvejkfcamc5560gxxq6rv9yudwj4p7nxg8m2qrad7j8"
    }
  }
}'

# Create multisig reward pool
node cosmwasm/submit-proposal.js execute \
  -c Rewards \
  -t "Create pool for stellar-t1-2025-q1 in axelar multisig" \
  -d "Create pool for stellar-t1-2025-q1 in axelar multisig" \
  --runAs axelar1zlr7e5qf3sz7yf890rkh9tcnu87234k6k7ytd9 \
  --deposit 100000000 \
  --msg '{
  "create_pool": {
    "params": {
      "epoch_duration": "100",
      "participation_threshold": [
        "8",
        "10"
      ],
      "rewards_per_epoch": "100"
    },
    "pool_id": {
      "chain_name": "stellar-t1-2025-q1",
      "contract": "axelar19jxy26z0qnnspa45y5nru0l5rmy9d637z5km2ndjxthfxf5qaswst9290r"
    }
  }
}'

# Update_verifier_set
axd tx wasm execute $PROVER '"update_verifier_set"' $ARGS

# Update ampd with stellar chain config
kubectl edit configmaps ampd-set-2-axelar-amplifier-worker-config -n devnet-amplifier

# Rotate genesis verifier set on Stellar Gateway
node stellar/gateway.js rotate

# Deploy Gas Service
node stellar/deploy-contract.js deploy axelar_gas_service --version v1.0.0

# Deploy Gas Operators
node stellar/deploy-contract.js deploy axelar_operators --version v1.0.0

# Register refunder address as an operator
node stellar/operators.js --action add_operator --chain-name "stellar-t1-2025-q1" -e $ENV --args $REFUNDER_ADDRESS

# Add funds to reward pools
echo $KEYRING_PASSWORD | axelard tx wasm execute axelar1vaj9sfzc3z0gpel90wu4ljutncutv0wuhvvwfsh30rqxq422z89qnd989l '{"add_rewards":{"pool_id":{"chain_name":"stellar-t1-2025-q1","contract":"axelar19jxy26z0qnnspa45y5nru0l5rmy9d637z5km2ndjxthfxf5qaswst9290r"}}}' --amount 1000000uamplifier --from validator

echo $KEYRING_PASSWORD | axelard tx wasm execute axelar1vaj9sfzc3z0gpel90wu4ljutncutv0wuhvvwfsh30rqxq422z89qnd989l '{"add_rewards":{"pool_id":{"chain_name":"stellar-t1-2025-q1","contract":"axelar1y6hjxuarlevd86kxvejkfcamc5560gxxq6rv9yudwj4p7nxg8m2qrad7j8"}}}' --amount 1000000uamplifier --from validator
```

## Checklist

The following checks should be performed after the rollout

- [ ] Stellar → EVM GMP call

```bash
node stellar/gateway.js call-contract [destination-chain] [dest-address] [payload]
```

- [ ] EVM → Stellar GMP call

```bash
node evm/gateway.js --action callContract -n [source-chain] --destinationChain [destination-chain] --destination [dest-stellar-address] --payload [payload]
```
