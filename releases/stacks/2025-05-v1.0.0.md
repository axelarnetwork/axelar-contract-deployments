# Stacks v1.0.0

|                | **Owner**                           |
|----------------|-------------------------------------|
| **Created By** | @raress96 <rares.serban@buidly.com> |
| **Deployment** | @raress96 <rares.serban@buidly.com> |

| **Network**          | **Deployment Status** | **Date**  |
|----------------------|-----------------------|-----------|
| **Devnet Amplifier** | Deployed              | 2025-05-0 |
| **Testnet**          | -                     | TBD       |
| **Mainnet**          | -                     | TBD       |

## Background

Changes in the release:

This is the v1.0.0 initial release.

### Pre-requisites

Make sure to have [Clarinet](https://docs.hiro.so/stacks/clarinet) installed to be able to interact with the Stacks
network.

## Deployment: Phase 1

Create an `.env` config. `CHAIN` should be set to `stacks`.

```yaml
ENV=xyz
CHAIN=stacks
```

An initial Stacks chain config needs to be added to the `${ENV}.json` file under `chains` key.

#### Devnet-Amplifier / Testnet

```bash
\"$CHAIN\": {
  "name": "Stacks",
  "axelarId": \"$CHAIN\",
  "rpc": "https://api.testnet.hiro.so",
  "tokenSymbol": "STX",
  "networkType": "testnet",
  "chainType": "stacks",
  "finality": "1",
  "decimals": 6,
  "approxFinalityWaitTime": 1,
  "explorer": {
    "name": "Stacks Explorer",
    "url": "https://explorer.hiro.so/?chain=testnet"
  },
  "contracts": {}
}
```

#### Mainnet

```bash
\"$CHAIN\": {
  "name": "Stacks",
  "axelarId": \"$CHAIN\",
  "rpc": "https://api.hiro.so",
  "tokenSymbol": "STX",
  "networkType": "mainnet",
  "chainType": "stacks",
  "finality": "1",
  "decimals": 6,
  "approxFinalityWaitTime": 1,
  "explorer": {
    "name": "Stacks Explorer",
    "url": "https://explorer.hiro.so"
  },
  "contracts": {}
}
```

1. Stacks contracts need to be deployed from a new account. You can generate a new Stacks account by running:

```bash
node stacks/generate-wallet.js
```

Make sure to save the `Mnemonic` and `Address` to a safe place!

Update your `.env` file to include the following:

```bash
STACKS_MNEMONIC=[mnemonic from above step]
```

2. Fund the account with STX

For Devnet-Amplifier and Testnet, you can use the faucet script:

```bash
node stacks/faucet.js --mnemonic $STACKS_MNEMONIC
```

3. Prepare contracts for deployment:

Download the latest release of
the [Axelar Stacks Bridge](https://github.com/Trust-Machines/axelar_stacks_bridge/releases) and copy the contracts to
the `./stacks/contracts` folder:

```bash
wget -O axelar_stacks_bridge_v1.0.0.zip https://github.com/Trust-Machines/axelar_stacks_bridge/archive/refs/tags/1.0.0.zip
unzip axelar_stacks_bridge_v1.0.0.zip
cp -r axelar_stacks_bridge-1.0.0/contracts/. ./stacks/contracts/
rm axelar_stacks_bridge_v1.0.0.zip
rm -rf axelar_stacks_bridge-1.0.0
```

Then run:

```bash
node stacks/prepare-contracts.js
```

This will replace appropriate Stacks Clarity Trait references with the correct Stacks Address from the wallet generated
above.

4. Deploy contracts:

#### clarity-stacks

```bash
node stacks/deploy-contract.js --contract clarity-stacks
```

#### gas-storage

```bash
node stacks/deploy-contract.js --contract gas-storage
```

#### traits

```bash
node stacks/deploy-contract.js --contract traits
```

#### gas-impl

```bash
node stacks/deploy-contract.js --contract gas-impl
```

#### gateway-storage

```bash
node stacks/deploy-contract.js --contract gateway-storage
```

#### gas-service

```bash
node stacks/deploy-contract.js --contract gas-service
```

#### gateway-impl

```bash
node stacks/deploy-contract.js --contract gateway-impl
```

#### gateway

```bash
node stacks/deploy-contract.js --contract gateway
```

#### governance

```bash
node stacks/deploy-contract.js --contract governance
```

#### interchain-token-service-storage

```bash
node stacks/deploy-contract.js --contract interchain-token-service-storage
```

#### interchain-token-factory

```bash
node stacks/deploy-contract.js --contract interchain-token-factory
```

#### interchain-token-service

```bash
node stacks/deploy-contract.js --contract interchain-token-service
```

#### interchain-token-factory-impl

```bash
node stacks/deploy-contract.js --contract interchain-token-factory-impl
```

#### verify-onchain

```bash
node stacks/deploy-contract.js --contract verify-onchain
```

#### interchain-token-service-impl

```bash
node stacks/deploy-contract.js --contract interchain-token-service-impl
```

5. Check that all contracts have been deployed successfully:

```bash
node stacks/check-contracts.js
```

If you do not get any errors above, then the deployment can be continued.

6. At this point, you should deploy the [Stacks CosmWasm Axelar contracts](../cosmwasm/2025-05-Stacks-v1.0.0.md) by
   following the instructions there.

## Deployment: Phase 2

> **_NOTE:_** Ensure that the [Stacks CosmWasm Axelar contracts](../cosmwasm/2025-05-Stacks-v1.0.0.md) are deployed on
> the Axelar Network before calling setup on the Stacks contracts!

1. Setup gas-service

```bash
node stacks/setup-contract.js GasService --gasCollector "[relayer wallet address]"
```

2. Setup gateway

| Network              | `minimumRotationDelay` | `previousSignerRetention` |
|----------------------|------------------------|---------------------------| 
| **Devnet-amplifier** | `0`                    | `15`                      |
| **Testnet**          | `3600`                 | `15`                      |
| **Mainnet**          | `86400`                | `15`                      |

```bash
node stacks/setup-contract.js Gateway --operator "[operator wallet address]" --minimumRotationDelay "[minimum rotation delay]" --previousSignerRetention "[previous signer retention]"
```

3. Setup interchain-token-service

| Network              | `trustedChains`        |
|----------------------|------------------------| 
| **Devnet-amplifier** | `avalanche-fuji,sui-2` |
| **Testnet**          | `TBD`                  |
| **Mainnet**          | `TBD`                  |

```bash
node stacks/setup-contract.js InterchainTokenService --operator "[operator wallet address]" --trustedChains "[trusted chains]"
```

4. Setup governance

| Network              | `governanceChain` | `governanceAddress`                          |
|----------------------|-------------------|----------------------------------------------| 
| **Devnet-amplifier** | `avalanche-fuji`  | `0x9279Da42329a01D4bf1229FCFA5cABF7B3c9D383` |
| **Testnet**          | `TBD`             | `TBD`                                        |
| **Mainnet**          | `TBD`             | `TBD`                                        |

```bash
node stacks/setup-contract.js Governance --governanceChain "[governance chain]" --governanceAddress "[governance address]"
```

## Checklist: TODO

The following checks should be performed after the rollout:

### Stacks → EVM GMP/ITS call

1. Send a GMP and ITS call

2. Route GMP call via Amplifier

- https://docs.axelar.dev/dev/amplifier/chain-integration/relay-messages

3. Submit proof with multisig session id

```bash
# Change `PRIVATE_KEY and `ENV` in `.env` from Stacks to EVM
node evm/gateway.js -n [destination-chain] --action submitProof --multisigSessionId [multisig session id]
```

4. Confirm whether the message is approved

```bash
node evm/gateway.js -n [destination-chain] --action isContractCallApproved --commandID [command-id] --sourceChain $CHAIN --sourceAddress [source-address] --destination [destination-address] --payloadHash 0x1ac7d1b81b7ba1025b36ccb86723da6ee5a87259f1c2fd5abe69d3200b512ec8
```

### EVM → Stacks ITS call

1. Interchain Token Transfer for Native Interchain Token

```bash
node stacks/decode-address.js [stacks-address] # TODO:
node evm/its.js --action interchainTransfer -n [source-chain] --destinationChain $CHAIN --destinationAddress [decoded-recipient-address] --tokenId [token-id] --amount [amount]
```
