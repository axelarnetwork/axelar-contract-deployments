# Stacks v1.0.0

|                | **Owner**                           |
|----------------|-------------------------------------|
| **Created By** | @raress96 <rares.serban@buidly.com> |
| **Deployment** | @raress96 <rares.serban@buidly.com> |

| **Network**          | **Deployment Status** | **Date**  |
|----------------------|-----------------------|-----------|
| **Devnet Amplifier** | Deployed              | 2025-05-0 |
| **Testnet**          | -                     | TBD       |
| **Mainnet**          | -                     | TBD       |

## Background

Changes in the release:

This is the v1.0.0 initial release.

## Deployment: Phase 1

Create an `.env` config. `CHAIN` should be set to `stacks`.

```yaml
ENV=xyz
CHAIN=stacks
```

An initial Stacks chain config needs to be added to the `${ENV}.json` file under `chains` key.

#### Devnet-Amplifier / Testnet

```bash
\"$CHAIN\": {
  "name": "Stacks",
  "axelarId": \"$CHAIN\",
  "rpc": "https://api.testnet.hiro.so",
  "tokenSymbol": "STX",
  "networkType": "testnet",
  "chainType": "stacks",
  "finality": "1",
  "decimals": 6,
  "approxFinalityWaitTime": 1,
  "explorer": {
    "name": "Stacks Explorer",
    "url": "https://explorer.hiro.so/?chain=testnet"
  },
  "contracts": {}
}
```

#### Mainnet

```bash
\"$CHAIN\": {
  "name": "Stacks",
  "axelarId": \"$CHAIN\",
  "rpc": "https://api.hiro.so",
  "tokenSymbol": "STX",
  "networkType": "mainnet",
  "chainType": "stacks",
  "finality": "1",
  "decimals": 6,
  "approxFinalityWaitTime": 1,
  "explorer": {
    "name": "Stacks Explorer",
    "url": "https://explorer.hiro.so"
  },
  "contracts": {}
}
```

1. Stacks contracts need to be deployed from a new account. You can generate a new Stacks account by running:

```bash
node stacks/generate-wallet.js
```

Make sure to save the `Mnemonic` and `Address` to a safe place!

Update your `.env` file to include the following:

```bash
STACKS_MNEMONIC=[mnemonic from above step]
```

2. Fund the account with STX

For Devnet-Amplifier and Testnet, you can use the faucet script:

```bash
node stacks/faucet.js --mnemonic $STACKS_MNEMONIC
```

3. Prepare contracts for deployment:

Download the latest release of
the [Axelar Stacks Bridge](https://github.com/Trust-Machines/axelar_stacks_bridge/releases) and copy the contracts to
the `./stacks/contracts` folder:

```bash
wget -O axelar_stacks_bridge_v1.0.0.zip https://github.com/Trust-Machines/axelar_stacks_bridge/archive/refs/tags/1.0.0.zip
unzip axelar_stacks_bridge_v1.0.0.zip
cp -r axelar_stacks_bridge-1.0.0/contracts/. ./stacks/contracts/
rm axelar_stacks_bridge_v1.0.0.zip
rm -rf axelar_stacks_bridge-1.0.0
```

Then run:

```bash
node stacks/prepare-contracts.js
```

This will replace appropriate Stacks Clarity Trait references with the correct Stacks Address from the wallet generated
above and will also replace other snippets of code depending on the environment.

4. Deploy contracts:

#### clarity-stacks

```bash
node stacks/deploy-contract.js --contract clarity-stacks
```

#### gas-storage

```bash
node stacks/deploy-contract.js --contract gas-storage
```

#### traits

```bash
node stacks/deploy-contract.js --contract traits
```

#### gas-impl

```bash
node stacks/deploy-contract.js --contract gas-impl
```

#### gateway-storage

```bash
node stacks/deploy-contract.js --contract gateway-storage
```

#### gas-service

```bash
node stacks/deploy-contract.js --contract gas-service
```

#### gateway-impl

```bash
node stacks/deploy-contract.js --contract gateway-impl
```

#### gateway

```bash
node stacks/deploy-contract.js --contract gateway
```

#### governance

```bash
node stacks/deploy-contract.js --contract governance
```

#### interchain-token-service-storage

```bash
node stacks/deploy-contract.js --contract interchain-token-service-storage
```

#### interchain-token-factory

```bash
node stacks/deploy-contract.js --contract interchain-token-factory
```

#### interchain-token-service

```bash
node stacks/deploy-contract.js --contract interchain-token-service
```

#### interchain-token-factory-impl

```bash
node stacks/deploy-contract.js --contract interchain-token-factory-impl
```

#### verify-onchain

```bash
node stacks/deploy-contract.js --contract verify-onchain
```

#### interchain-token-service-impl

```bash
node stacks/deploy-contract.js --contract interchain-token-service-impl
```

#### native-interchain-token

This contract is used by the Relayer.

```bash
node stacks/deploy-contract.js --contract native-interchain-token
```

5. Check that all contracts have been deployed successfully:

```bash
node stacks/check-contracts.js
```

If you do not get any errors above, then the deployment can be continued.

6. At this point, you should deploy the [Stacks CosmWasm Axelar contracts](../cosmwasm/2025-05-Stacks-v1.0.0.md) by
   following the instructions there.

## Deployment: Phase 2

> **_NOTE:_** Ensure that the [Stacks CosmWasm Axelar contracts](../cosmwasm/2025-05-Stacks-v1.0.0.md) are deployed on
> the Axelar Network before calling setup on the Stacks contracts!

1. Setup gas-service

```bash
node stacks/setup-contract.js GasService --gasCollector "[relayer wallet address]"
```

2. Setup gateway

| Network              | `minimumRotationDelay` | `previousSignerRetention` |
|----------------------|------------------------|---------------------------| 
| **Devnet-amplifier** | `0`                    | `15`                      |
| **Testnet**          | `3600`                 | `15`                      |
| **Mainnet**          | `86400`                | `15`                      |

```bash
node stacks/setup-contract.js Gateway --operator "[operator wallet address]" --minimumRotationDelay "[minimum rotation delay]" --previousSignerRetention "[previous signer retention]"
```

3. Setup interchain-token-service

| Network              | `trustedChains`        |
|----------------------|------------------------| 
| **Devnet-amplifier** | `avalanche-fuji,sui-2` |
| **Testnet**          | `TBD`                  |
| **Mainnet**          | `TBD`                  |

```bash
node stacks/setup-contract.js InterchainTokenService --operator "[operator wallet address]" --trustedChains "[trusted chains]"
```

4. Setup governance

| Network              | `governanceChain` | `governanceAddress`                          |
|----------------------|-------------------|----------------------------------------------| 
| **Devnet-amplifier** | `avalanche-fuji`  | `0x9279Da42329a01D4bf1229FCFA5cABF7B3c9D383` |
| **Testnet**          | `TBD`             | `TBD`                                        |
| **Mainnet**          | `TBD`             | `TBD`                                        |

```bash
node stacks/setup-contract.js Governance --governanceChain "[governance chain]" --governanceAddress "[governance address]"
```

## Checklist

Make sure that all contracts have been deployed & setup successfully and that no transactions have failed by checking
the Stacks Explorer.

In order to perform routing of messages from Stacks to Axelar Network and vice versa, an instance of
the [Stacks Relayer](https://github.com/Trust-Machines/axelar-stacks-relayer) should be configured and started. This is
because the Stacks integration uses custom CosmWasm contracts which require translation of Stacks specific ITS payload
to ABI payload.

Then, the following checks should be performed after the rollout:

### Stacks → EVM ITS call

#### Setup token

1. Deploy `sample-sip-010` token to use for testing

```bash
node stacks/deploy-contract.js --contract sample-sip-010 --name sample-sip-010
```

2. Deploy & setup token manager for token

```bash
node stacks/deploy-contract.js --contract token-manager --name token-manager-sample
```

```bash
node stacks/setup-contract.js TokenManager --name TokenManagerSample --token "[address of the token]"
```

3. Register the token manager on Stacks ITS contract

```bash
node stacks/its-example.js register-token-manager TokenManagerSample
```

4. Deploy the token on another chain

```bash
node stacks/its-example.js deploy-remote-canonical-interchain-token TokenManagerSample --destinationChain "[destination chain]" --gasValue "[gas value in STX]"
```

5. Route GMP call via Amplifier/Relayer

#### Interchain transfer

1. Do interchain transfer with sample token

```bash
node stacks/its-example.js interchain-transfer TokenManagerSample --destinationChain "[destination chain]" --destinationAddress "[destination-address]" --value "[denominated value in token]" --gasValue "[gas value in STX]"
```

2. Route GMP call via Amplifier/Relayer

### EVM → Stacks ITS call

1. Interchain Token Transfer for Native Interchain Token

```bash
node stacks/decode-address.js [stacks-address]
node evm/its.js interchain-transfer -n [source-chain] $CHAIN [token-id] [decoded-recipient-address] [amount] -p [evm private key]
```
