# Ampd v1.12.2

|                | **Owner**                         |
| -------------- | --------------------------------- |
| **Created By** | @eguajardo <edwin@interoplabs.io> |
| **Deployment** | @eguajardo <edwin@interoplabs.io> |

| **Network**          | **Deployment Status** | **Date** |
| -------------------- | --------------------- | -------- |
| **Devnet Amplifier** | -                     | TBD      |
| **Stagenet**         | -                     | TBD      |
| **Testnet**          | -                     | TBD      |
| **Mainnet**          | -                     | TBD      |

[Release](https://github.com/axelarnetwork/axelar-amplifier/releases/tag/ampd-v1.12.2)

## Background

This ampd release removes overhead by filtering out events before reaching each handler and adds these bugfixes:

- Fixes account sequence getting out of sync during high concurrency
- Fixes ampd hanging during shutdown process

## Config change

The basic config, regardless of supported chains, requires some additions to the `event_processor`, `broadcast`, and `grpc` sections. If any of these sections is missing entirely from the config, ampd is already using the default values and there is no need to add the section just for these new entries. Note that each section in ampd config file must either be missing entirely (so the default values are used) or have all fields set, partially defined sections will cause ampd to fail due to missing configuration.

Below are the new entries for each section.

```
# Commented out entries are not new entries introduced in this release. They are kept here for reference.

[event_processor]
# retry_delay = "1s"
# retry_max_attempts = 3
# stream_timeout = "15s"
# stream_buffer_size = 100000
# delay = "1s"
tx_broadcast_buffer_size = "10"

[broadcast]
# chain_id = "axelar-dojo-1"
# tx_fetch_interval = "500ms"
# tx_fetch_max_retries = 10
# gas_adjustment = 1.2
# gas_price = "0.00005uaxl"
# batch_gas_limit = 1000000
# queue_cap = 1000
# broadcast_interval = "5s"
tx_confirmation_buffer_size = "10"
tx_confirmation_queue_cap = "1000"

[grpc]
# ip_addr = "127.0.0.1"
# port = 9090
# global_concurrency_limit = 1024
# concurrency_limit_per_connection = 32
# request_timeout = "30s"
blockchain_service.chains = []
```

- `tx_broadcast_buffer_size` is the maximum number of messages to enqueue for broadcasting concurrently (higher values increase throughput for processing many messages at once, lower values reduce resource consumption).
- `tx_confirmation_buffer_size` is the maximum concurrent transaction confirmations (higher values improve throughput, lower values reduce resource usage).
- `tx_confirmation_queue_cap` is the maximum size of the confirmation queue (larger values buffer more transactions during spikes but use more memory; smaller values risk dropping requests under load)
- `blockchain_service.chains=[]` is currently not in use. This config is reserved for a work in progress feature.

## Deployment

Restart ampd with the new binary. Binaries can be found [here](https://github.com/axelarnetwork/axelar-amplifier/releases/tag/ampd-v1.12.2)

### Checklist

Run the below command to output the version:

```
$ ampd --version
ampd 1.12.2
```

Check `ampd` logs to ensure it restarts fine. Monitor voting and signing for your verifier on axelarscan to verify it's operating correctly.
