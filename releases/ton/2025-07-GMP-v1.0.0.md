# TON v1.0.0

|  | **Owner** |
|-----------|------------|
| **Created By** | @makischristou <makis@commonprefix.com> |
| **Deployment** | @makischristou <makis@commonprefix.com> |

| **Network** | **Deployment Status** | **Date** |
|-------------|----------------------|----------|
| **Devnet Amplifier** | Deployed | 2025-07-01 |
| **Stagenet** | - | TBD |
| **Testnet** | - | TBD |
| **Mainnet** | - | TBD |

## Background

This is the initial v1.0.0 release.

## Deployment

1. Clone the [axelar-gmp-sdk-ton](https://github.com/commonprefix/axelar-gmp-sdk-ton) repository:

```bash
git clone git@github.com:commonprefix/axelar-gmp-sdk-ton.git
```

2. Install dependencies:

```bash
npm i
```

3. Deploy AxelarGateway:

Prerequisites: 
- A funded testnet TON wallet. The easiest choice is to use [Tonkeeper](https://tonkeeper.com/) on a mobile device and fund it using the [testgiver](https://t.me/testgiver_ton_bot) testnet faucet.

To deploy the AxelarGateway, we first need to choose a signer set to initialize it with. Create a new `signers.json` file in the root of the project and populate it with the initial signer set. For example:

```json
{
    "signers": [
        {
            "signer": "79607624103790023686192160900267678169386878801005916234280733090365959006096",
            "weight": 1
        }
    ],
    "threshold": 1,
    "nonce": 7336708
}
```

Run the AxelarGateway deployment script:

```bash
npx blueprint run
? Choose file to use (Use arrow keys)
? Choose file to use deployAxelarGateway
? Which network do you want to use?
? Which network do you want to use? testnet
? Which wallet are you using? (Use arrow keys)
? Which wallet are you using? TON Connect compatible mobile
wallet (example: Tonkeeper)
```

Choose `deployAxelarGateway`, then `testnet` and then `TON Connect compatible wallet`. Scan the QR code from Tonkeeper on your mobile device to connect it. Approve the 2 transactions on your Tonkeeper wallet (one is for deployment and one for signer initialization).


4. Deploy Governance:

When deploying Governance, you will be prompted to provide 3 arguments. The first is the AxelarGateway address which we can use from the previous step. The governance needs this since it's an executable and should only allow execution commands from the trusted gateway. The gas for execution argument is a lower bound of gas (in nanoton) which needs to be sent to the governance contract when executing a proposal. Finally, we need to include an operator address who is able to run operator proposals without a timelock.


```bash
? Choose file to use
? Choose file to use deployGovernance
? Which network do you want to use?
? Which network do you want to use? testnet
? Which wallet are you using? (Use arrow keys)
? Which wallet are you using? TON Connect compatible mobile wallet (example: Tonkeeper)
Connected to wallet at address: <YOUR_WALLET_ADDRESS>
? AxelarGateway address <AXELAR_GATEWAY_ADDRESS>
? Gas for execution <YOUR_GAS_EXECUTION_THRESHOLD>
? Operator address <YOUR_OPERATOR_ADDRESS>
```

5. Deploy GasService:

To deploy the GasService, follow the steps below. You will be prompted to provide the address of the gasCollector.

```bash
npx blueprint run
? Choose file to use
? Choose file to use deployGasService
? Which network do you want to use?
? Which network do you want to use? testnet
? Which wallet are you using? (Use arrow keys)
? Which wallet are you using? TON Connect compatible mobile wallet (example: Tonkeeper)
Connected to wallet at address: <YOUR_WALLET_ADDRESS>
? GasCollector address <GAS_COLLECTOR_ADDRESS>
```

## Checklist
The following checks should be performed after the rollout:

Required environment variables:

```
MNEMONIC=
TONCENTER_API_KEY=
TON_GATEWAY_ADDRESS=
TON_GAS_SERVICE_ADDRESS=
TON_GOVERNANCE_ADDRESS=
```

### Approving a message

Run this with the hex encoded payload produced by the TON MultisigProver:

```bash
node ton/approveMessages.js <encoded-payload-hex>
```


### Executing a message

Run this to execute an approved message:

```bash
node ton/relayerExecute.js <message-id> <source-chain> <source-address> <payload-hex> <executable-address> <destination-chain> <payload-hash>
```


### Sending a message from TON

```bash
node ton/callContract.js <destination-chain> <destination-contract-address> <payload-hex>
```


### Post Deployment (Initialize Signers)

```bash
node ton/initializeSigners.js <weighted-signers-json>
```

### Signer Rotation
In our design, signer rotation is a 2-step process. Thus, we need both the proof generated by the MultisigProver and the new signer config separately, as it is not included in that proof. You can get the signer config after rotating the signer set as described in step 13 in the [TON cosmwasm release doc](../cosmwasm/2025-07-TON-v1.0.0.md) by querying the multisig prover using

```bash
axelard query wasm contract-state smart $MULTISIG_PROVER "{\"proof\":{\"multisig_session_id\":\"$SESSION_ID\"}}" --node $RPC --output json
```

```bash
node ton/signerRotation.js <encoded-payload-hex> <weighted-signers-json>
```

Where `weighted-signers-json` would be in the format:

```json
{
  "signers": [
    {
      "signer": "79607624103790023686192160900267678169386878801005916234280733090365959006096",
      "weight": "1"
    }
  ],
  "threshold": "1",
  "nonce": "0"
}
```

Note that the signer public keys need to be sorted.

### Transfer Operatorship
```bash
node ton/transferOperatorship.js <new-operator-address>
```
