
# Ton operational scripts

This folder contains operational scripts for the Ton AxelarGateway. It assumes an already deployed AxelarGateway.fc and an Executable.fc.

Required enviroment variables

```
MNEMONIC=
TONCENTER_API_KEY=
TON_GATEWAY_ADDRESS=
TON_GAS_SERVICE_ADDRESS=
TON_GOVERNANCE_ADDRESS=
```

## Appoving a message

Run this with the hex encoded payload procuded by the Ton MultisigProver.

```bash
node ton/approveMessages.js <encoded-payload-hex>
```


## Executing a message

Run this to execute an approve message

```bash
node ton/relayerExecute.js "<message-id>" "<source-chain>" "<source-address>" "<payload-hex>" "<executable-address>" "<destination-chain>" "<payload-hash>"
```


## Sending a message from ton

```bash
node ton/callContract.js "<destination-chain>" "<destination-contract-address>" "<payload-hex>"
```


## Post Deployment (initialize signers)

```bash
node ton/initializeSigners.js '<weighted-signers-json>'
```

## Signer Rotation
In our design signer rotation is a 2 step process. Thus we need both the proof generated by the MultisigProver but also the new signer config separately as it is not included in that proof.

```bash
node ton/signerRotation.js <encoded-payload-hex> '<weighted-signers-json>'
```

Where `weighted-signers-json` would be in the format:

```json
{
  "signers": [
    {
      "signer": "79607624103790023686192160900267678169386878801005916234280733090365959006096",
      "weight": "1"
    }
  ],
  "threshold": "1",
  "nonce": "0"
}
```

## Transfer operatorship

```bash
node ton/transferOperatorship.js "<new-operator-address>"
```

## Gas Service Scripts

Pay native gas for a contract call

```bash
node ton/gasService.js pay-native-gas "<destination-chain>" "<destination-address>" "<payload-hex>" "<refund-address>" <gas-amount>
```

Pay jetton gas for a contract call

```bash
node ton/gasService.js pay-jetton-gas "<jetton-minter-address>" "<jetton-amount>" "<destination-chain>" "<destination-address>" "<payload-hex>"
```

Collect native gas

```bash
node ton/gasService.js collect-gas "<receiver-address>" "<amount>"
```

Collect Jettons

```bash
node ton/gasService.js collect-jettons "<receiver-address>" "<jetton-amount>" "<jetton-minter-address>"
```


Add native gas to previous transaction

```bash
node ton/gasService.js add-native-gas "<tx-hash>" "<refund-address>" "<gas-amount>"
```

Add jetton gas to previous transaction

```bash
node ton/gasService.js add-jetton-gas "<tx-hash>" "<jetton-minter-address>" "<jetton-amount>" "<refund-address>"
```

Refund native gas

```bash
node ton/gasService.js native-refund "<tx-hash>" "<refund-address>" "<refund-amount>"
```

Jetton refund

```bash
node ton/gasService.js jetton-refund "<tx-hash>" "<receiver-address>" "<jetton-amount>" "<jetton-minter-address>"
```

Update Gas Info

```bash
node ton/gasService.js update-gas-info '<gas-info-json>' "<gas-amount>"
```

Where `gas-info-json` would be in the format:

```json
{
  "ethereum": {
    "gasEstimationType": 2,
    "l1FeeScalar": 800000,
    "axelarBaseFee": 300000,
    "relativeGasPrice": 1500000,
    "relativeBlobBaseFee": 80000,
    "expressFee": 750000
  }
}
```

Pay Gas (on chain estimation)

```bash
node ton/gasService.js pay-gas "<destination-chain>" "<destination-address>" "<payload-hex>" "<refund-address>" "<execution-gas-limit>" "<estimate-on-chain>" "<gas-amount>"
```

## Governance

Executing a timelock proposal

```bash
node ton/governance.js execute-timelock-proposal "<target-address>" "<native-ton-amount>" "<proposal-hash>" "<proposal-hex-data>" "<timelock-seconds>" "<actual-timelock-value>" "<gas-amount>"
```

Executing an operator proposal

```bash
node ton/governance.js execute-operator-proposal "<target-address>" "<native-ton-amount>" "<proposal-hash>" "<proposal-hex-data>" "<gas-amount>"
```
